var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__export=(e,t)=>{for(var o in t)__defProp(e,o,{get:t[o],enumerable:!0})},__copyProps=(e,t,o,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of __getOwnPropNames(t))!__hasOwnProp.call(e,i)&&i!==o&&__defProp(e,i,{get:()=>t[i],enumerable:!(s=__getOwnPropDesc(t,i))||s.enumerable});return e},__toCommonJS=e=>__copyProps(__defProp({},"__esModule",{value:!0}),e),main_exports={};__export(main_exports,{SideBarModule:()=>SideBarModule,ToolPanelColDefService:()=>ToolPanelColDefService}),module.exports=__toCommonJS(main_exports);var import_core10=require("@ag-grid-community/core"),import_core11=require("@ag-grid-enterprise/core"),import_core=require("@ag-grid-community/core"),ToolPanelColDefService=class extends import_core.BeanStub{constructor(){super(...arguments),this.beanName="toolPanelColDefService",this.isColGroupDef=e=>e&&typeof e.children<"u",this.getId=e=>this.isColGroupDef(e)?e.groupId:e.colId}wireBeans(e){this.columnModel=e.columnModel}createColumnTree(e){const t=[],o=(i,n)=>{if(this.isColGroupDef(i)){const r=i,a=typeof r.groupId<"u"?r.groupId:r.headerName,l=new import_core.AgProvidedColumnGroup(r,a,!1,n),d=[];return r.children.forEach(c=>{const u=o(c,n+1);u&&d.push(u)}),l.setChildren(d),l}else{const r=i,a=r.colId?r.colId:r.field,l=this.columnModel.getColDefCol(a);return l||t.push(r),l}},s=[];return e.forEach(i=>{const n=o(i,0);n&&s.push(n)}),t.length>0&&(0,import_core._warnOnce)("unable to find grid columns for the supplied colDef(s):",t),s}syncLayoutWithGrid(e){const t=this.getLeafPathTrees(),o=this.mergeLeafPathTrees(t);e(o)}getLeafPathTrees(){const e=(s,i)=>{let n;if((0,import_core.isProvidedColumnGroup)(s))if(s.isPadding())n=i;else{const a=Object.assign({},s.getColGroupDef());a.groupId=s.getGroupId(),a.children=[i],n=a}else{const a=Object.assign({},s.getColDef());a.colId=s.getColId(),n=a}const r=s.getOriginalParent();return r?e(r,n):n};return this.columnModel.getCols().filter(s=>{const i=s.getColDef();return s.isPrimary()&&!i.showRowGroup}).map(s=>e(s,s.getColDef()))}mergeLeafPathTrees(e){const t=(i,n)=>this.isColGroupDef(i)&&this.isColGroupDef(n)&&this.getId(i)===this.getId(n),o=(i,n)=>{if(!this.isColGroupDef(n))return i;const r=i,a=n;return a.children&&a.groupId&&this.addChildrenToGroup(r,a.groupId,a.children[0])||a.children.forEach(l=>o(r,l)),r},s=[];for(let i=1;i<=e.length;i++){const n=e[i-1],r=e[i];t(n,r)?e[i]=o(n,r):s.push(n)}return s}addChildrenToGroup(e,t,o){const s=(r,a)=>{const l=r.children.map(this.getId),d=(0,import_core._includes)(l,this.getId(a)),c=(0,import_core._last)(r.children),u=c&&this.getId(c)!==this.getId(a);return d&&u};if(!this.isColGroupDef(e))return!0;const i=e,n=o;if(s(i,n))return i.children.push(n),!0;if(i.groupId===t){const r=i.children.map(this.getId);if(!(0,import_core._includes)(r,this.getId(n)))return i.children.push(n),!0}return i.children.forEach(r=>this.addChildrenToGroup(r,t,o)),!1}},import_core2=require("@ag-grid-community/core");function isSideBarVisible(e){return e.sideBarService?.getSideBarComp().isDisplayed()??!1}function setSideBarVisible(e,t){e.sideBarService?.getSideBarComp().setDisplayed(t)}function setSideBarPosition(e,t){e.sideBarService?.getSideBarComp().setSideBarPosition(t)}function openToolPanel(e,t){e.sideBarService?.getSideBarComp().openToolPanel(t,"api")}function closeToolPanel(e){e.sideBarService?.getSideBarComp().close("api")}function getOpenedToolPanel(e){return e.sideBarService?.getSideBarComp().openedItem()??null}function refreshToolPanel(e){e.sideBarService?.getSideBarComp().refresh()}function isToolPanelShowing(e){return e.sideBarService?.getSideBarComp().isToolPanelShowing()??!1}function getToolPanelInstance(e,t){const o=e.sideBarService?.getSideBarComp().getToolPanelInstance(t);return(0,import_core2._unwrapUserComp)(o)}function getSideBar(e){return e.sideBarService?.getSideBarComp().getDef()}var import_core9=require("@ag-grid-community/core"),import_core8=require("@ag-grid-community/core"),import_core4=require("@ag-grid-community/core"),import_core3=require("@ag-grid-community/core"),SideBarButtonComp=class extends import_core3.Component{constructor(e){super(),this.eToggleButton=import_core3.RefPlaceholder,this.eIconWrapper=import_core3.RefPlaceholder,this.eLabel=import_core3.RefPlaceholder,this.toolPanelDef=e}getToolPanelId(){return this.toolPanelDef.id}postConstruct(){const e=this.createTemplate();this.setTemplate(e,[]),this.setLabel(),this.setIcon(),this.addManagedElementListeners(this.eToggleButton,{click:this.onButtonPressed.bind(this)}),this.eToggleButton.setAttribute("id",`ag-${this.getCompId()}-button`)}createTemplate(){return`<div class="ag-side-button" role="presentation">
                <button type="button" data-ref="eToggleButton" tabindex="-1" role="tab" aria-expanded="false" class="ag-button ag-side-button-button">
                    <div data-ref="eIconWrapper" class="ag-side-button-icon-wrapper" aria-hidden="true"></div>
                    <span data-ref="eLabel" class="ag-side-button-label"></span>
                </button>
            </div>`}setLabel(){const e=this.localeService.getLocaleTextFunc(),t=this.toolPanelDef,o=e(t.labelKey,t.labelDefault);this.eLabel.innerText=o}setIcon(){this.eIconWrapper.insertAdjacentElement("afterbegin",(0,import_core3._createIconNoSpan)(this.toolPanelDef.iconKey,this.gos))}onButtonPressed(){this.dispatchLocalEvent({type:"toggleButtonClicked"})}setSelected(e){this.addOrRemoveCssClass("ag-selected",e),(0,import_core3._setAriaExpanded)(this.eToggleButton,e)}getButtonElement(){return this.eToggleButton}},AgSideBarButtons=class extends import_core4.Component{constructor(){super('<div class="ag-side-buttons" role="tablist"></div>'),this.buttonComps=[]}wireBeans(e){this.focusService=e.focusService,this.visibleColsService=e.visibleColsService}postConstruct(){this.addManagedElementListeners(this.getFocusableElement(),{keydown:this.handleKeyDown.bind(this)})}handleKeyDown(e){if(e.key!==import_core4.KeyCode.TAB||!e.shiftKey)return;const t=(0,import_core4._last)(this.visibleColsService.getAllCols());this.focusService.focusGridView(t,!0)&&e.preventDefault()}setActiveButton(e){this.buttonComps.forEach(t=>{t.setSelected(e===t.getToolPanelId())})}addButtonComp(e){const t=this.createBean(new SideBarButtonComp(e));return this.buttonComps.push(t),this.appendChild(t),t.addEventListener("toggleButtonClicked",()=>{this.dispatchLocalEvent({type:"sideBarButtonClicked",toolPanelId:e.id})}),t}clearButtons(){this.buttonComps=this.destroyBeans(this.buttonComps),(0,import_core4._clearElement)(this.getGui()),super.destroy()}destroy(){this.clearButtons(),super.destroy()}},AgSideBarButtonsSelector={selector:"AG-SIDE-BAR-BUTTONS",component:AgSideBarButtons},import_core5=require("@ag-grid-community/core"),DEFAULT_COLUMN_COMP={id:"columns",labelDefault:"Columns",labelKey:"columns",iconKey:"columns",toolPanel:"agColumnsToolPanel"},DEFAULT_FILTER_COMP={id:"filters",labelDefault:"Filters",labelKey:"filters",iconKey:"filter",toolPanel:"agFiltersToolPanel"},DEFAULT_BY_KEY={columns:DEFAULT_COLUMN_COMP,filters:DEFAULT_FILTER_COMP};function parseSideBarDef(e){if(!e)return;if(e===!0)return{toolPanels:[DEFAULT_COLUMN_COMP,DEFAULT_FILTER_COMP],defaultToolPanel:"columns"};if(typeof e=="string")return parseSideBarDef([e]);if(Array.isArray(e)){const o=[];return e.forEach(s=>{const i=DEFAULT_BY_KEY[s];if(!i){logMissingKey(s);return}o.push(i)}),o.length===0?void 0:{toolPanels:o,defaultToolPanel:o[0].id}}return{toolPanels:parseComponents(e.toolPanels),defaultToolPanel:e.defaultToolPanel,hiddenByDefault:e.hiddenByDefault,position:e.position}}function logMissingKey(e){(0,import_core5._warnOnce)(`the key ${e} is not a valid key for specifying a tool panel, valid keys are: ${Object.keys(DEFAULT_BY_KEY).join(",")}`)}function parseComponents(e){const t=[];return e&&e.forEach(o=>{let s=null;if(typeof o=="string"){const i=DEFAULT_BY_KEY[o];if(!i){logMissingKey(o);return}s=i}else s=o;t.push(s)}),t}var import_core7=require("@ag-grid-community/core"),import_core6=require("@ag-grid-community/core"),AgHorizontalResize=class extends import_core6.Component{constructor(){super('<div class="ag-tool-panel-horizontal-resize"></div>'),this.minWidth=100,this.maxWidth=null}wireBeans(e){this.horizontalResizeService=e.horizontalResizeService}setElementToResize(e){this.elementToResize=e}postConstruct(){const e=this.horizontalResizeService.addResizeBar({eResizeBar:this.getGui(),dragStartPixels:1,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this),onResizeEnd:this.onResizeEnd.bind(this)});this.addDestroyFunc(e),this.setInverted(this.gos.get("enableRtl"))}dispatchResizeEvent(e,t,o){const s={type:"toolPanelSizeChanged",width:o,started:e,ended:t};this.eventService.dispatchEvent(s)}onResizeStart(){this.startingWidth=this.elementToResize.offsetWidth,this.dispatchResizeEvent(!0,!1,this.startingWidth)}onResizeEnd(e){return this.onResizing(e,!0)}onResizing(e,t=!1){const o=this.inverted?-1:1;let s=Math.max(this.minWidth,Math.floor(this.startingWidth-e*o));this.maxWidth!=null&&(s=Math.min(this.maxWidth,s)),this.elementToResize.style.width=`${s}px`,this.dispatchResizeEvent(!1,t,s)}setInverted(e){this.inverted=e}setMaxWidth(e){this.maxWidth=e}setMinWidth(e){e!=null?this.minWidth=e:this.minWidth=100}},ToolPanelWrapper=class extends import_core7.Component{wireBeans(e){this.userComponentFactory=e.userComponentFactory}constructor(){super('<div class="ag-tool-panel-wrapper" role="tabpanel"/>')}postConstruct(){const e=this.getGui(),t=this.resizeBar=this.createManagedBean(new AgHorizontalResize);e.setAttribute("id",`ag-${this.getCompId()}`),t.setElementToResize(e),this.appendChild(t)}getToolPanelId(){return this.toolPanelId}setToolPanelDef(e,t){const{id:o,minWidth:s,maxWidth:i,width:n}=e;this.toolPanelId=o,this.width=n;const r=this.userComponentFactory.getToolPanelCompDetails(e,t),a=r.newAgStackInstance();if(this.params=r.params,a==null){(0,import_core7._warnOnce)(`error processing tool panel component ${o}. You need to specify 'toolPanel'`);return}a.then(this.setToolPanelComponent.bind(this)),s!=null&&this.resizeBar.setMinWidth(s),i!=null&&this.resizeBar.setMaxWidth(i)}setToolPanelComponent(e){this.toolPanelCompInstance=e,this.appendChild(e.getGui()),this.addDestroyFunc(()=>{this.destroyBean(e)}),this.width&&(this.getGui().style.width=`${this.width}px`)}getToolPanelInstance(){return this.toolPanelCompInstance}setResizerSizerSide(e){const t=this.gos.get("enableRtl"),o=e==="left",s=t?o:!o;this.resizeBar.setInverted(s)}refresh(){this.toolPanelCompInstance?.refresh(this.params)}},AgSideBar=class extends import_core8.Component{constructor(){super(`<div class="ag-side-bar ag-unselectable">
            <ag-side-bar-buttons data-ref="sideBarButtons"></ag-side-bar-buttons>
        </div>`,[AgSideBarButtonsSelector]),this.sideBarButtons=import_core8.RefPlaceholder,this.toolPanelWrappers=[]}wireBeans(e){this.focusService=e.focusService,this.filterManager=e.filterManager,this.sideBarService=e.sideBarService}postConstruct(){this.sideBarButtons.addEventListener("sideBarButtonClicked",this.onToolPanelButtonClicked.bind(this));const{sideBar:e}=this.gos.get("initialState")??{};this.setSideBarDef({sideBarDef:parseSideBarDef(this.gos.get("sideBar")),sideBarState:e}),this.addManagedPropertyListener("sideBar",this.onSideBarUpdated.bind(this)),this.sideBarService.registerSideBarComp(this);const t=this.getFocusableElement();this.createManagedBean(new import_core8.ManagedFocusFeature(t,{onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this)})),(0,import_core8._addFocusableContainerListener)(this,t,this.focusService)}onTabKeyDown(e){if(e.defaultPrevented)return;const{focusService:t,sideBarButtons:o}=this,s=this.getGui(),i=o.getGui(),n=this.gos.getActiveDomElement(),r=s.querySelector(".ag-tool-panel-wrapper:not(.ag-hidden)"),a=e.target;if(!r)return;if(i.contains(n)){t.focusInto(r,e.shiftKey)&&e.preventDefault();return}if(!e.shiftKey)return;let l=null;r.contains(n)?l=this.focusService.findNextFocusableElement(r,void 0,!0):t.isTargetUnderManagedComponent(r,a)&&e.shiftKey&&(l=this.focusService.findFocusableElementBeforeTabGuard(r,a)),l||(l=i.querySelector(".ag-selected button")),l&&l!==e.target&&(e.preventDefault(),l.focus())}handleKeyDown(e){const t=this.gos.getActiveDomElement();if(!this.sideBarButtons.getGui().contains(t))return;const o=this.sideBarButtons.getGui(),s=Array.prototype.slice.call(o.querySelectorAll(".ag-side-button")),i=s.findIndex(a=>a.contains(t));let n=null;switch(e.key){case import_core8.KeyCode.LEFT:case import_core8.KeyCode.UP:n=Math.max(0,i-1);break;case import_core8.KeyCode.RIGHT:case import_core8.KeyCode.DOWN:n=Math.min(i+1,s.length-1);break}if(n===null)return;const r=s[n].querySelector("button");r&&(r.focus(),e.preventDefault())}onToolPanelButtonClicked(e){const t=e.toolPanelId;this.openedItem()===t?this.openToolPanel(void 0,"sideBarButtonClicked"):this.openToolPanel(t,"sideBarButtonClicked")}clearDownUi(){this.sideBarButtons.clearButtons(),this.destroyToolPanelWrappers()}setSideBarDef({sideBarDef:e,sideBarState:t,existingToolPanelWrappers:o}){if(this.setDisplayed(!1),this.sideBar=e,this.sideBar&&this.sideBar.toolPanels){const s=this.sideBar.toolPanels;if(this.createToolPanelsAndSideButtons(s,t,o),!this.toolPanelWrappers.length)return;const i=t?t.visible:!this.sideBar.hiddenByDefault;if(this.setDisplayed(i),this.setSideBarPosition(t?t.position:this.sideBar.position),i)if(t){const{openToolPanel:n}=t;n&&this.openToolPanel(n,"sideBarInitializing")}else this.openToolPanel(this.sideBar.defaultToolPanel,"sideBarInitializing")}}getDef(){return this.sideBar}setSideBarPosition(e){e||(e="right"),this.position=e;const t=e==="left",o=t?"right":"left";return this.addOrRemoveCssClass("ag-side-bar-left",t),this.addOrRemoveCssClass("ag-side-bar-right",!t),this.toolPanelWrappers.forEach(s=>{s.setResizerSizerSide(o)}),this.eventService.dispatchEvent({type:"sideBarUpdated"}),this}setDisplayed(e,t){super.setDisplayed(e,t),this.eventService.dispatchEvent({type:"sideBarUpdated"})}getState(){const e={};return this.toolPanelWrappers.forEach(t=>{e[t.getToolPanelId()]=t.getToolPanelInstance()?.getState?.()}),{visible:this.isDisplayed(),position:this.position,openToolPanel:this.openedItem(),toolPanels:e}}createToolPanelsAndSideButtons(e,t,o){for(const s of e)this.createToolPanelAndSideButton(s,t?.toolPanels?.[s.id],o?.[s.id])}validateDef(e){if(e.id==null)return(0,import_core8._warnOnce)("please review all your toolPanel components, it seems like at least one of them doesn't have an id"),!1;if(e.toolPanel==="agColumnsToolPanel"&&!import_core8.ModuleRegistry.__assertRegistered(import_core8.ModuleNames.ColumnsToolPanelModule,"Column Tool Panel",this.gridId))return!1;if(e.toolPanel==="agFiltersToolPanel"){if(!import_core8.ModuleRegistry.__assertRegistered(import_core8.ModuleNames.FiltersToolPanelModule,"Filters Tool Panel",this.gridId))return!1;if(this.filterManager?.isAdvancedFilterEnabled())return(0,import_core8._warnOnce)("Advanced Filter does not work with Filters Tool Panel. Filters Tool Panel has been disabled."),!1}return!0}createToolPanelAndSideButton(e,t,o){if(!this.validateDef(e))return;const s=this.sideBarButtons.addButtonComp(e);let i;o?i=o:(i=this.createBean(new ToolPanelWrapper),i.setToolPanelDef(e,{initialState:t,onStateUpdated:()=>this.eventService.dispatchEvent({type:"sideBarUpdated"})})),i.setDisplayed(!1);const n=i.getGui();this.appendChild(n),this.toolPanelWrappers.push(i),(0,import_core8._setAriaControls)(s.getButtonElement(),n)}refresh(){this.toolPanelWrappers.forEach(e=>e.refresh())}openToolPanel(e,t="api"){const o=this.openedItem();if(o===e)return;this.toolPanelWrappers.forEach(n=>{const r=e===n.getToolPanelId();n.setDisplayed(r)});const s=this.openedItem();o!==s&&(this.sideBarButtons.setActiveButton(e),this.raiseToolPanelVisibleEvent(e,o??void 0,t))}getToolPanelInstance(e){const t=this.toolPanelWrappers.filter(o=>o.getToolPanelId()===e)[0];if(!t){(0,import_core8._warnOnce)(`unable to lookup Tool Panel as invalid key supplied: ${e}`);return}return t.getToolPanelInstance()}raiseToolPanelVisibleEvent(e,t,o){const s=!!e&&!!t;if(t){const i={type:"toolPanelVisibleChanged",source:o,key:t,visible:!1,switchingToolPanel:s};this.eventService.dispatchEvent(i)}if(e){const i={type:"toolPanelVisibleChanged",source:o,key:e,visible:!0,switchingToolPanel:s};this.eventService.dispatchEvent(i)}}close(e="api"){this.openToolPanel(void 0,e)}isToolPanelShowing(){return!!this.openedItem()}openedItem(){let e=null;return this.toolPanelWrappers.forEach(t=>{t.isDisplayed()&&(e=t.getToolPanelId())}),e}onSideBarUpdated(){const e=parseSideBarDef(this.gos.get("sideBar")),t={};e&&this.sideBar&&e.toolPanels?.forEach(o=>{const{id:s}=o;if(!s)return;const i=this.sideBar.toolPanels?.find(l=>l.id===s);if(!i||o.toolPanel!==i.toolPanel)return;const n=this.toolPanelWrappers.find(l=>l.getToolPanelId()===s);if(!n)return;const r=this.gos.addGridCommonParams({...o.toolPanelParams??{},onStateUpdated:()=>this.eventService.dispatchEvent({type:"sideBarUpdated"})});n.getToolPanelInstance()?.refresh(r)===!0&&(this.toolPanelWrappers=this.toolPanelWrappers.filter(l=>l!==n),(0,import_core8._removeFromParent)(n.getGui()),t[s]=n)}),this.clearDownUi(),this.setSideBarDef({sideBarDef:e,existingToolPanelWrappers:t})}destroyToolPanelWrappers(){this.toolPanelWrappers.forEach(e=>{(0,import_core8._removeFromParent)(e.getGui()),this.destroyBean(e)}),this.toolPanelWrappers.length=0}destroy(){this.destroyToolPanelWrappers(),super.destroy()}},AgSideBarSelector={selector:"AG-SIDE-BAR",component:AgSideBar},SideBarService=class extends import_core9.BeanStub{constructor(){super(...arguments),this.beanName="sideBarService"}registerSideBarComp(e){this.sideBarComp=e}getSideBarComp(){return this.sideBarComp}getSideBarSelector(){return AgSideBarSelector}},VERSION="32.0.0",SideBarCoreModule={version:VERSION,moduleName:`${import_core10.ModuleNames.SideBarModule}-core`,beans:[ToolPanelColDefService,SideBarService],dependantModules:[import_core11.EnterpriseCoreModule]},SideBarApiModule={version:VERSION,moduleName:`${import_core10.ModuleNames.SideBarModule}-api`,apiFunctions:{isSideBarVisible,setSideBarVisible,setSideBarPosition,openToolPanel,closeToolPanel,getOpenedToolPanel,refreshToolPanel,isToolPanelShowing,getToolPanelInstance,getSideBar},dependantModules:[SideBarCoreModule]},SideBarModule={version:VERSION,moduleName:import_core10.ModuleNames.SideBarModule,dependantModules:[SideBarCoreModule,SideBarApiModule]};
