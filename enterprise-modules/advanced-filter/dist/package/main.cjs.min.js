var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__export=(e,t)=>{for(var i in t)__defProp(e,i,{get:t[i],enumerable:!0})},__copyProps=(e,t,i,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of __getOwnPropNames(t))!__hasOwnProp.call(e,a)&&a!==i&&__defProp(e,a,{get:()=>t[a],enumerable:!(s=__getOwnPropDesc(t,a))||s.enumerable});return e},__toCommonJS=e=>__copyProps(__defProp({},"__esModule",{value:!0}),e),main_exports={};__export(main_exports,{AdvancedFilterModule:()=>AdvancedFilterModule}),module.exports=__toCommonJS(main_exports);var import_core25=require("@ag-grid-community/core"),import_core26=require("@ag-grid-enterprise/core");function getAdvancedFilterModel(e){return e.filterManager?.getAdvancedFilterModel()??null}function setAdvancedFilterModel(e,t){e.filterManager?.setAdvancedFilterModel(t)}function showAdvancedFilterBuilder(e){e.filterManager?.toggleAdvancedFilterBuilder(!0,"api")}function hideAdvancedFilterBuilder(e){e.filterManager?.toggleAdvancedFilterBuilder(!1,"api")}var import_core=require("@ag-grid-community/core"),ADVANCED_FILTER_LOCALE_TEXT={ariaAdvancedFilterBuilderItem:e=>`${e[0]}. Level ${e[1]}. Press ENTER to edit`,ariaAdvancedFilterBuilderItemValidation:e=>`${e[0]}. Level ${e[1]}. ${e[2]} Press ENTER to edit`,ariaAdvancedFilterBuilderList:"Advanced Filter Builder List",ariaAdvancedFilterBuilderFilterItem:"Filter Condition",ariaAdvancedFilterBuilderGroupItem:"Filter Group",ariaAdvancedFilterBuilderColumn:"Column",ariaAdvancedFilterBuilderOption:"Option",ariaAdvancedFilterBuilderValue:"Value",ariaAdvancedFilterBuilderJoinOperator:"Join Operator",ariaAdvancedFilterInput:"Advanced Filter Input",ariaLabelAdvancedFilterAutocomplete:"Advanced Filter Autocomplete",advancedFilterContains:"contains",advancedFilterNotContains:"does not contain",advancedFilterTextEquals:"equals",advancedFilterTextNotEqual:"does not equal",advancedFilterStartsWith:"begins with",advancedFilterEndsWith:"ends with",advancedFilterBlank:"is blank",advancedFilterNotBlank:"is not blank",advancedFilterEquals:"=",advancedFilterNotEqual:"!=",advancedFilterGreaterThan:">",advancedFilterGreaterThanOrEqual:">=",advancedFilterLessThan:"<",advancedFilterLessThanOrEqual:"<=",advancedFilterTrue:"is true",advancedFilterFalse:"is false",advancedFilterAnd:"AND",advancedFilterOr:"OR",advancedFilterApply:"Apply",advancedFilterBuilder:"Builder",advancedFilterValidationMissingColumn:"Column is missing",advancedFilterValidationMissingOption:"Option is missing",advancedFilterValidationMissingValue:"Value is missing",advancedFilterValidationInvalidColumn:"Column not found",advancedFilterValidationInvalidOption:"Option not found",advancedFilterValidationMissingQuote:"Value is missing an end quote",advancedFilterValidationNotANumber:"Value is not a number",advancedFilterValidationInvalidDate:"Value is not a valid date",advancedFilterValidationMissingCondition:"Condition is missing",advancedFilterValidationJoinOperatorMismatch:"Join operators within a condition must be the same",advancedFilterValidationInvalidJoinOperator:"Join operator not found",advancedFilterValidationMissingEndBracket:"Missing end bracket",advancedFilterValidationExtraEndBracket:"Too many end brackets",advancedFilterValidationMessage:e=>`Expression has an error. ${e[0]} - ${e[1]}.`,advancedFilterValidationMessageAtEnd:e=>`Expression has an error. ${e[0]} at end of expression.`,advancedFilterBuilderTitle:"Advanced Filter",advancedFilterBuilderApply:"Apply",advancedFilterBuilderCancel:"Cancel",advancedFilterBuilderAddButtonTooltip:"Add Filter or Group",advancedFilterBuilderRemoveButtonTooltip:"Remove",advancedFilterBuilderMoveUpButtonTooltip:"Move Up",advancedFilterBuilderMoveDownButtonTooltip:"Move Down",advancedFilterBuilderAddJoin:"Add Group",advancedFilterBuilderAddCondition:"Add Filter",advancedFilterBuilderSelectColumn:"Select a column",advancedFilterBuilderSelectOption:"Select an option",advancedFilterBuilderEnterValue:"Enter a value...",advancedFilterBuilderValidationAlreadyApplied:"Current filter already applied.",advancedFilterBuilderValidationIncomplete:"Not all conditions are complete.",advancedFilterBuilderValidationSelectColumn:"Must select a column.",advancedFilterBuilderValidationSelectOption:"Must select an option.",advancedFilterBuilderValidationEnterValue:"Must enter a value."};function getSearchString(e,t,i){if(!e)return"";const s=i-t;return s?e.slice(0,e.length-s):e}function updateExpression(e,t,i,s,a,r,n){const o=i+(!e.length||n?0:1);let l=0;return a&&(e[o]===" "?l=1:(s+=" ",r&&(s+='"'))),{updatedValue:e.slice(0,t)+s+e.slice(o),updatedPosition:t+s.length+l}}function findStartPosition(e,t,i){let s=t;for(;s<i&&e[s]===" ";)s++;return s}function findEndPosition(e,t,i,s){let a=t,r=!1;for(;a<e.length;){const n=e[a];if(n==="("){s&&e[a-1]===" "?r=!0:a=a-1;break}else if(n===" "||i&&n===")"){a=a-1;break}a++}return{endPosition:a,isEmpty:r}}function checkAndUpdateExpression(e,t,i,s){i!==t&&(e.expression=updateExpression(e.expression,s-t.length+1,s,i).updatedValue)}function escapeQuotes(e){return e.replace(/(['"])/,"\\$1")}var ColumnParser=class{constructor(e,t){this.params=e,this.startPosition=t,this.type="column",this.valid=!0,this.hasStartChar=!1,this.hasEndChar=!1,this.colName=""}parse(e,t){if(e===ColFilterExpressionParser.COL_START_CHAR&&!this.colName)this.hasStartChar=!0;else if(e===ColFilterExpressionParser.COL_END_CHAR&&this.hasStartChar){if(this.parseColumn(!1,t))return this.hasEndChar=!0,!1;this.colName+=e}else this.colName+=e}getDisplayValue(){return(this.hasStartChar?ColFilterExpressionParser.COL_START_CHAR:"")+this.colName+(this.hasEndChar?ColFilterExpressionParser.COL_END_CHAR:"")}getColId(){return this.colId}complete(e){this.parseColumn(!0,e)}getValidationError(){return this.valid?null:{message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationInvalidColumn"),startPosition:this.startPosition,endPosition:this.endPosition??this.params.expression.length-1}}parseColumn(e,t){this.endPosition=t;const i=this.params.advancedFilterExpressionService.getColId(this.colName);return i&&this.hasStartChar&&(this.colId=i.colId,checkAndUpdateExpression(this.params,this.colName,i.columnName,t-1),this.colName=i.columnName,this.column=this.params.columnModel.getColDefCol(this.colId),this.column)?(this.baseCellDataType=this.params.dataTypeService?.getBaseDataType(this.column)??"text",!0):(e&&(this.valid=!1),this.baseCellDataType="text",!1)}},OperatorParser=class{constructor(e,t,i){this.params=e,this.startPosition=t,this.baseCellDataType=i,this.type="operator",this.valid=!0,this.expectedNumOperands=0,this.operator=""}parse(e,t){if(e===" "||e===")"){if(this.parseOperator(!1,t-1))return!0;this.operator+=e}else this.operator+=e}complete(e){this.parseOperator(!0,e)}getValidationError(){return this.valid?null:{message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationInvalidOption"),startPosition:this.startPosition,endPosition:this.endPosition??this.params.expression.length-1}}getDisplayValue(){return this.operator}getOperatorKey(){return this.parsedOperator}parseOperator(e,t){const i=this.params.advancedFilterExpressionService.getDataTypeExpressionOperator(this.baseCellDataType),s=i.findOperator(this.operator);if(this.endPosition=t,s){this.parsedOperator=s;const r=i.operators[s];this.expectedNumOperands=r.numOperands;const n=r.displayValue;return checkAndUpdateExpression(this.params,this.operator,n,t),this.operator=n,!0}return(e||!(s===null))&&(this.valid=!1),!1}},OperandParser=class{constructor(e,t,i,s){this.params=e,this.startPosition=t,this.baseCellDataType=i,this.column=s,this.type="operand",this.valid=!0,this.operand="",this.validationMessage=null}parse(e,t){if(e===" ")if(this.quotes)this.operand+=e;else return this.parseOperand(!1,t),!0;else if(e===")"){if(this.baseCellDataType==="number"||!this.quotes)return this.parseOperand(!1,t-1),!0;this.operand+=e}else if(!this.operand&&!this.quotes&&(e==="'"||e==='"'))this.quotes=e;else{if(this.quotes&&e===this.quotes)return this.parseOperand(!1,t),!1;this.operand+=e}}complete(e){this.parseOperand(!0,e)}getValidationError(){return this.validationMessage?{message:this.validationMessage,startPosition:this.startPosition,endPosition:this.endPosition??this.params.expression.length-1}:null}getRawValue(){return this.operand}getModelValue(){return this.modelValue}parseOperand(e,t){const{advancedFilterExpressionService:i}=this.params;if(this.endPosition=t,this.modelValue=this.operand,e&&this.quotes)this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationMissingQuote");else if(this.modelValue==="")this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationMissingValue");else{const s=i.getOperandModelValue(this.operand,this.baseCellDataType,this.column);switch(s!=null&&(this.modelValue=s),this.baseCellDataType){case"number":(this.quotes||isNaN(this.modelValue))&&(this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationNotANumber"));break;case"date":case"dateString":s==null&&(this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationInvalidDate"));break}}}},ColFilterExpressionParser=class{constructor(e,t){this.params=e,this.startPosition=t,this.isAwaiting=!0}parseExpression(){let e=this.startPosition;const{expression:t}=this.params;for(;e<t.length;){const i=t[e];if(!(i===" "&&this.isAwaiting)){if(this.isAwaiting=!1,!this.parser){let a;this.columnParser?this.operatorParser?(this.operandParser=new OperandParser(this.params,e,this.columnParser.baseCellDataType,this.columnParser.column),a=this.operandParser):(this.operatorParser=new OperatorParser(this.params,e,this.columnParser.baseCellDataType),a=this.operatorParser):(this.columnParser=new ColumnParser(this.params,e),a=this.columnParser),this.parser=a}const s=this.parser.parse(i,e);if(s!=null){if(this.isComplete())return this.returnEndPosition(s?e-1:e,!0);this.parser=void 0,this.isAwaiting=!0}}e++}return this.parser?.complete?.(e-1),this.returnEndPosition(e)}isValid(){return this.isComplete()&&this.columnParser.valid&&this.operatorParser.valid&&(!this.operandParser||this.operandParser.valid)}getValidationError(){const e=this.columnParser?.getValidationError()??this.operatorParser?.getValidationError()??this.operandParser?.getValidationError();if(e)return e;const t=this.params.expression.length;let i;return this.columnParser?this.operatorParser?this.operatorParser.expectedNumOperands&&!this.operandParser&&(i="advancedFilterValidationMissingValue"):i="advancedFilterValidationMissingOption":i="advancedFilterValidationMissingColumn",i?{message:this.params.advancedFilterExpressionService.translate(i),startPosition:t,endPosition:t}:null}getFunctionString(e){return this.getFunctionCommon(e,(t,i,s,a)=>{const r=escapeQuotes(s),n=t==null?"":`, params.operands[${t}]`;return`params.operators[${i}].evaluator(expressionProxy.getValue('${r}', node), node, params.evaluatorParams[${a}]${n})`})}getFunctionParsed(e){return this.getFunctionCommon(e,(t,i,s,a)=>(r,n,o)=>o.operators[i].evaluator(r.getValue(s,n),n,o.evaluatorParams[a],t==null?void 0:o.operands[t]))}getAutocompleteListParams(e){if(this.isColumnPosition(e))return this.getColumnAutocompleteListParams(e);if(this.isOperatorPosition(e))return this.getOperatorAutocompleteListParams(e);if(!this.isBeyondEndPosition(e))return{enabled:!1}}updateExpression(e,t,i){const{expression:s}=this.params;if(this.isColumnPosition(e))return updateExpression(this.params.expression,this.startPosition,this.columnParser?.getColId()?this.columnParser.endPosition:findEndPosition(s,e).endPosition,this.params.advancedFilterExpressionService.getColumnValue(t),!0);if(this.isOperatorPosition(e)){const a=this.getBaseCellDataTypeFromOperatorAutocompleteType(i),r=this.hasOperand(a,t.key),n=r&&this.doesOperandNeedQuotes(a);let o;if(this.operatorParser?.startPosition!=null&&e<this.operatorParser.startPosition)o=updateExpression(s,e,e,t.displayValue??t.key,r,n);else{let l,u=!1;if(this.operatorParser?.getOperatorKey())l=this.operatorParser.endPosition;else{const{endPosition:d,isEmpty:c}=findEndPosition(s,e,!0,!0);l=d,u=c}o=updateExpression(s,findStartPosition(s,this.columnParser.endPosition+1,l),l,t.displayValue??t.key,r,n,u)}return{...o,hideAutocomplete:!r}}return null}getModel(){const e=this.columnParser.getColId(),t={filterType:this.columnParser.baseCellDataType,colId:e,type:this.operatorParser.getOperatorKey()};return this.operatorParser.expectedNumOperands&&(t.filter=this.operandParser.getModelValue()),t}getFunctionCommon(e,t){const i=this.columnParser.getColId(),s=this.operatorParser?.getOperatorKey(),{operators:a,evaluatorParams:r,operands:n}=e,o=this.params.advancedFilterExpressionService.getExpressionOperator(this.columnParser.baseCellDataType,s),l=this.addToListAndGetIndex(a,o),u=this.params.advancedFilterExpressionService.getExpressionEvaluatorParams(i),d=this.addToListAndGetIndex(r,u),c=this.operatorParser?.expectedNumOperands===0?void 0:this.addToListAndGetIndex(n,this.getOperandValue());return t(c,l,i,d)}getOperandValue(){let e=this.operandParser.getRawValue();const{baseCellDataType:t,column:i}=this.columnParser;switch(t){case"number":e=Number(e);break;case"date":case"dateString":e=this.params.valueService.parseValue(i,null,e,void 0);break}if(t==="dateString"){const{dataTypeService:s}=this.params;return s?s.getDateParserFunction(i)(e):e}return e}isComplete(){return!!(this.operatorParser&&(!this.operatorParser.expectedNumOperands||this.operatorParser.expectedNumOperands&&this.operandParser))}isColumnPosition(e){return!this.columnParser||this.columnParser.endPosition==null||e<=this.columnParser.endPosition+1}isOperatorPosition(e){return!this.operatorParser||this.operatorParser.endPosition==null||e<=this.operatorParser.endPosition+1}isBeyondEndPosition(e){return this.isComplete()&&this.endPosition!=null&&e>this.endPosition+1&&this.endPosition+1<this.params.expression.length}returnEndPosition(e,t){return this.endPosition=t?e:e-1,e}getColumnAutocompleteListParams(e){return this.params.advancedFilterExpressionService.generateAutocompleteListParams(this.params.advancedFilterExpressionService.getColumnAutocompleteEntries(),"column",this.getColumnSearchString(e))}getColumnSearchString(e){const t=this.columnParser?.getDisplayValue()??"",i=getSearchString(t,e,this.columnParser?.endPosition==null?this.params.expression.length:this.columnParser.endPosition+1),s=this.columnParser?.hasStartChar&&i.length>0,a=this.columnParser?.hasEndChar&&i.length===t.length+2;return s?i.slice(1,a?-1:void 0):i}getOperatorAutocompleteListParams(e){const t=this.columnParser?.column;if(!t)return{enabled:!1};const i=this.columnParser.baseCellDataType,s=this.operatorParser?.startPosition!=null&&e<this.operatorParser.startPosition?"":getSearchString(this.operatorParser?.getDisplayValue()??"",e,this.operatorParser?.endPosition==null?this.params.expression.length:this.operatorParser.endPosition+1);return this.params.advancedFilterExpressionService.generateAutocompleteListParams(this.params.advancedFilterExpressionService.getOperatorAutocompleteEntries(t,i),`operator-${i}`,s)}getBaseCellDataTypeFromOperatorAutocompleteType(e){return e?.replace("operator-","")}hasOperand(e,t){return!e||!t||(this.params.advancedFilterExpressionService.getExpressionOperator(e,t)?.numOperands??0)>0}doesOperandNeedQuotes(e){return e!=="number"}addToListAndGetIndex(e,t){const i=e.length;return e.push(t),i}};ColFilterExpressionParser.COL_START_CHAR="[",ColFilterExpressionParser.COL_END_CHAR="]";function findMatch(e,t,i){let s=!1;const a=e.toLocaleLowerCase(),r=a+" ",n=Object.entries(t).find(([,o])=>{const l=i(o).toLocaleLowerCase();return l.startsWith(r)&&(s=!0),l===a});return n?n[0]:s?null:void 0}function getEntries(e,t){return(t??Object.keys(e)).map(s=>({key:s,displayValue:e[s].displayValue}))}var TextFilterExpressionOperators=class{constructor(e){this.params=e,this.initOperators()}getEntries(e){return getEntries(this.operators,e)}findOperator(e){return findMatch(e,this.operators,({displayValue:t})=>t)}initOperators(){const{translate:e}=this.params;this.operators={contains:{displayValue:e("advancedFilterContains"),evaluator:(t,i,s,a)=>this.evaluateExpression(t,i,s,a,!1,(r,n)=>r.includes(n)),numOperands:1},notContains:{displayValue:e("advancedFilterNotContains"),evaluator:(t,i,s,a)=>this.evaluateExpression(t,i,s,a,!0,(r,n)=>!r.includes(n)),numOperands:1},equals:{displayValue:e("advancedFilterTextEquals"),evaluator:(t,i,s,a)=>this.evaluateExpression(t,i,s,a,!1,(r,n)=>r===n),numOperands:1},notEqual:{displayValue:e("advancedFilterTextNotEqual"),evaluator:(t,i,s,a)=>this.evaluateExpression(t,i,s,a,!0,(r,n)=>r!=n),numOperands:1},startsWith:{displayValue:e("advancedFilterStartsWith"),evaluator:(t,i,s,a)=>this.evaluateExpression(t,i,s,a,!1,(r,n)=>r.startsWith(n)),numOperands:1},endsWith:{displayValue:e("advancedFilterEndsWith"),evaluator:(t,i,s,a)=>this.evaluateExpression(t,i,s,a,!1,(r,n)=>r.endsWith(n)),numOperands:1},blank:{displayValue:e("advancedFilterBlank"),evaluator:t=>t==null||typeof t=="string"&&t.trim().length===0,numOperands:0},notBlank:{displayValue:e("advancedFilterNotBlank"),evaluator:t=>t!=null&&(typeof t!="string"||t.trim().length>0),numOperands:0}}}evaluateExpression(e,t,i,s,a,r){return e==null?a:i.caseSensitive?r(i.valueConverter(e,t),s):r(i.valueConverter(e,t).toLocaleLowerCase(),s.toLocaleLowerCase())}},ScalarFilterExpressionOperators=class{constructor(e){this.params=e,this.initOperators()}getEntries(e){return getEntries(this.operators,e)}findOperator(e){return findMatch(e,this.operators,({displayValue:t})=>t)}initOperators(){const{translate:e,equals:t}=this.params;this.operators={equals:{displayValue:e("advancedFilterEquals"),evaluator:(i,s,a,r)=>this.evaluateSingleOperandExpression(i,s,a,r,!!a.includeBlanksInEquals,t),numOperands:1},notEqual:{displayValue:e("advancedFilterNotEqual"),evaluator:(i,s,a,r)=>this.evaluateSingleOperandExpression(i,s,a,r,!!a.includeBlanksInEquals,(n,o)=>!t(n,o)),numOperands:1},greaterThan:{displayValue:e("advancedFilterGreaterThan"),evaluator:(i,s,a,r)=>this.evaluateSingleOperandExpression(i,s,a,r,!!a.includeBlanksInGreaterThan,(n,o)=>n>o),numOperands:1},greaterThanOrEqual:{displayValue:e("advancedFilterGreaterThanOrEqual"),evaluator:(i,s,a,r)=>this.evaluateSingleOperandExpression(i,s,a,r,!!a.includeBlanksInGreaterThan,(n,o)=>n>=o),numOperands:1},lessThan:{displayValue:e("advancedFilterLessThan"),evaluator:(i,s,a,r)=>this.evaluateSingleOperandExpression(i,s,a,r,!!a.includeBlanksInLessThan,(n,o)=>n<o),numOperands:1},lessThanOrEqual:{displayValue:e("advancedFilterLessThanOrEqual"),evaluator:(i,s,a,r)=>this.evaluateSingleOperandExpression(i,s,a,r,!!a.includeBlanksInLessThan,(n,o)=>n<=o),numOperands:1},blank:{displayValue:e("advancedFilterBlank"),evaluator:i=>i==null,numOperands:0},notBlank:{displayValue:e("advancedFilterNotBlank"),evaluator:i=>i!=null,numOperands:0}}}evaluateSingleOperandExpression(e,t,i,s,a,r){return e==null?a:r(i.valueConverter(e,t),s)}},BooleanFilterExpressionOperators=class{constructor(e){this.params=e,this.initOperators()}getEntries(e){return getEntries(this.operators,e)}findOperator(e){return findMatch(e,this.operators,({displayValue:t})=>t)}initOperators(){const{translate:e}=this.params;this.operators={true:{displayValue:e("advancedFilterTrue"),evaluator:t=>!!t,numOperands:0},false:{displayValue:e("advancedFilterFalse"),evaluator:t=>t===!1,numOperands:0},blank:{displayValue:e("advancedFilterBlank"),evaluator:t=>t==null,numOperands:0},notBlank:{displayValue:e("advancedFilterNotBlank"),evaluator:t=>t!=null,numOperands:0}}}},AdvancedFilterExpressionService=class extends import_core.BeanStub{constructor(){super(...arguments),this.beanName="advancedFilterExpressionService",this.columnNameToIdMap={},this.columnAutocompleteEntries=null,this.expressionEvaluatorParams={}}wireBeans(e){this.valueService=e.valueService,this.columnModel=e.columnModel,this.columnNameService=e.columnNameService,this.dataTypeService=e.dataTypeService}postConstruct(){this.expressionJoinOperators=this.generateExpressionJoinOperators(),this.expressionOperators=this.generateExpressionOperators()}parseJoinOperator(e){const{type:t}=e;return this.expressionJoinOperators[t]??t}getColumnDisplayValue(e){const{colId:t}=e,s=this.getColumnAutocompleteEntries().find(({key:r})=>r===t);let a;return s?(a=s.displayValue,this.columnNameToIdMap[a.toLocaleUpperCase()]={colId:t,columnName:a}):a=t,a}getOperatorDisplayValue(e){return this.getExpressionOperator(e.filterType,e.type)?.displayValue??e.type}getOperandModelValue(e,t,i){switch(t){case"number":return(0,import_core._exists)(e)?Number(e):null;case"date":return(0,import_core._serialiseDate)(this.valueService.parseValue(i,null,e,void 0),!1);case"dateString":{const s=this.valueService.parseValue(i,null,e,void 0);return this.dataTypeService?(0,import_core._serialiseDate)(this.dataTypeService.getDateParserFunction(i)(s)??null,!1):s}}return e}getOperandDisplayValue(e,t){const{colId:i,filter:s}=e,a=this.columnModel.getColDefCol(i);let r="";if(s!=null){let n;switch(e.filterType){case"number":n=(0,import_core._toStringOrNull)(s)??"";break;case"date":{const o=(0,import_core._parseDateTimeFromString)(s);n=a?this.valueService.formatValue(a,null,o):null;break}case"dateString":{let o;if(this.dataTypeService){const l=(0,import_core._parseDateTimeFromString)(s);o=a?this.dataTypeService?.getDateFormatterFunction(a)(l??void 0):null}else o=s;n=a?this.valueService.formatValue(a,null,o):null;break}}e.filterType!=="number"&&(n=n??(0,import_core._toStringOrNull)(s)??"",t||(n=`"${n}"`)),r=t?n:` ${n}`}return r}parseColumnFilterModel(e){const t=this.getColumnDisplayValue(e)??"",i=this.getOperatorDisplayValue(e)??"",s=this.getOperandDisplayValue(e);return`[${t}] ${i}${s}`}updateAutocompleteCache(e,t){if(t==="column"){const{key:i,displayValue:s}=e;this.columnNameToIdMap[e.displayValue.toLocaleUpperCase()]={colId:i,columnName:s}}}translate(e,t){let i=ADVANCED_FILTER_LOCALE_TEXT[e];return typeof i=="function"&&(i=i(t)),this.localeService.getLocaleTextFunc()(e,i,t)}generateAutocompleteListParams(e,t,i){return{enabled:!0,type:t,searchString:i,entries:e}}getColumnAutocompleteEntries(){if(this.columnAutocompleteEntries)return this.columnAutocompleteEntries;const e=this.columnModel.getColDefCols()??[],t=[],i=this.gos.get("includeHiddenColumnsInAdvancedFilter");return e.forEach(s=>{s.getColDef().filter&&(i||s.isVisible()||s.isRowGroupActive())&&t.push({key:s.getColId(),displayValue:this.columnNameService.getDisplayNameForColumn(s,"advancedFilter")})}),t.sort((s,a)=>{const r=s.displayValue??"",n=a.displayValue??"";return r<n?-1:n>r?1:0}),t}getOperatorAutocompleteEntries(e,t){const i=this.getActiveOperators(e);return this.getDataTypeExpressionOperator(t).getEntries(i)}getJoinOperatorAutocompleteEntries(){return Object.entries(this.expressionJoinOperators).map(([e,t])=>({key:e,displayValue:t}))}getDefaultAutocompleteListParams(e){return this.generateAutocompleteListParams(this.getColumnAutocompleteEntries(),"column",e)}getDataTypeExpressionOperator(e){return this.expressionOperators[e]}getExpressionOperator(e,t){return this.getDataTypeExpressionOperator(e)?.operators?.[t]}getExpressionJoinOperators(){return this.expressionJoinOperators}getColId(e){const t=e.toLocaleUpperCase(),i=this.columnNameToIdMap[t];if(i)return i;const a=this.getColumnAutocompleteEntries().find(({displayValue:r})=>r.toLocaleUpperCase()===t);if(a){const{key:r,displayValue:n}=a,o={colId:r,columnName:n};return this.columnNameToIdMap[t]=o,o}return null}getExpressionEvaluatorParams(e){let t=this.expressionEvaluatorParams[e];if(t)return t;const i=this.columnModel.getColDefCol(e);if(!i)return{valueConverter:r=>r};switch(this.dataTypeService?.getBaseDataType(i)){case"dateString":t={valueConverter:this.dataTypeService?.getDateParserFunction(i)??(r=>r)};break;case"object":i.getColDef().filterValueGetter?t={valueConverter:r=>r}:t={valueConverter:(r,n)=>this.valueService.formatValue(i,n,r)??(typeof r.toString=="function"?r.toString():"")};break;case"text":case void 0:t={valueConverter:r=>(0,import_core._toStringOrNull)(r)};break;default:t={valueConverter:r=>r};break}const{filterParams:a}=i.getColDef();return a&&["caseSensitive","includeBlanksInEquals","includeBlanksInLessThan","includeBlanksInGreaterThan"].forEach(r=>{const n=a[r];n&&(t[r]=n)}),this.expressionEvaluatorParams[e]=t,t}getColumnDetails(e){const t=this.columnModel.getColDefCol(e)??void 0,i=(t?this.dataTypeService?.getBaseDataType(t):void 0)??"text";return{column:t,baseCellDataType:i}}generateExpressionOperators(){const e=(t,i)=>this.translate(t,i);return{text:new TextFilterExpressionOperators({translate:e}),boolean:new BooleanFilterExpressionOperators({translate:e}),object:new TextFilterExpressionOperators({translate:e}),number:new ScalarFilterExpressionOperators({translate:e,equals:(t,i)=>t===i}),date:new ScalarFilterExpressionOperators({translate:e,equals:(t,i)=>t.getTime()===i.getTime()}),dateString:new ScalarFilterExpressionOperators({translate:e,equals:(t,i)=>t.getTime()===i.getTime()})}}getColumnValue({displayValue:e}){return`${ColFilterExpressionParser.COL_START_CHAR}${e}${ColFilterExpressionParser.COL_END_CHAR}`}generateExpressionJoinOperators(){return{AND:this.translate("advancedFilterAnd"),OR:this.translate("advancedFilterOr")}}getActiveOperators(e){const t=e.getColDef().filterParams?.filterOptions;return t&&t.every(s=>typeof s=="string")?t:void 0}resetColumnCaches(){this.columnAutocompleteEntries=null,this.columnNameToIdMap={},this.expressionEvaluatorParams={}}},import_core24=require("@ag-grid-community/core"),import_core22=require("@ag-grid-community/core"),import_core23=require("@ag-grid-enterprise/core"),import_core6=require("@ag-grid-community/core"),import_core5=require("@ag-grid-community/core"),import_core3=require("@ag-grid-community/core"),import_core4=require("@ag-grid-enterprise/core"),import_core2=require("@ag-grid-community/core"),AgAutocompleteRow=class extends import_core2.Component{constructor(){super(`
        <div class="ag-autocomplete-row" role="presentation">
            <div class="ag-autocomplete-row-label"></div>
        </div>`),this.hasHighlighting=!1}setState(e,t){this.value=e,this.render(),this.updateSelected(t)}updateSelected(e){this.addOrRemoveCssClass("ag-autocomplete-row-selected",e)}setSearchString(e){let t=!1;if((0,import_core2._exists)(e)){const i=this.value?.toLocaleLowerCase().indexOf(e.toLocaleLowerCase());if(i>=0){t=!0,this.hasHighlighting=!0;const s=i+e.length,a=(0,import_core2._escapeString)(this.value.slice(0,i)),r=(0,import_core2._escapeString)(this.value.slice(i,s)),n=(0,import_core2._escapeString)(this.value.slice(s));this.getGui().lastElementChild.innerHTML=`${a}<b>${r}</b>${n}`}}!t&&this.hasHighlighting&&(this.hasHighlighting=!1,this.render())}render(){this.getGui().lastElementChild.innerHTML=(0,import_core2._escapeString)(this.value)??"&nbsp;"}},AgAutocompleteList=class extends import_core3.PopupComponent{constructor(e){super(`<div class="ag-autocomplete-list-popup">
            <div data-ref="eList" class="ag-autocomplete-list"></div>
        <div>`),this.params=e,this.eList=import_core3.RefPlaceholder,this.searchString=""}destroy(){super.destroy()}postConstruct(){this.autocompleteEntries=this.params.autocompleteEntries,this.virtualList=this.createManagedBean(new import_core4.VirtualList({cssIdentifier:"autocomplete"})),this.virtualList.setComponentCreator(this.createRowComponent.bind(this)),this.eList.appendChild(this.virtualList.getGui()),this.virtualList.setModel({getRowCount:()=>this.autocompleteEntries.length,getRow:t=>this.autocompleteEntries[t]});const e=this.virtualList.getGui();this.addManagedListeners(e,{click:()=>this.params.onConfirmed(),mousemove:this.onMouseMove.bind(this),mousedown:t=>t.preventDefault()}),this.setSelectedValue(0)}onNavigationKeyDown(e,t){e.preventDefault();const i=this.autocompleteEntries.indexOf(this.selectedValue),s=t===import_core3.KeyCode.UP?i-1:i+1;this.checkSetSelectedValue(s)}setSearch(e){this.searchString=e,(0,import_core3._exists)(e)?this.runSearch():(this.autocompleteEntries=this.params.autocompleteEntries,this.virtualList.refresh(),this.checkSetSelectedValue(0)),this.updateSearchInList()}runContainsSearch(e,t){let i,s=!1;const a=e.toLocaleLowerCase(),r=t.filter(n=>{const l=n.toLocaleLowerCase().indexOf(a),u=l===0,d=l>=0;return d&&(!i||!s&&u||s===u&&n.length<i.length)&&(i=n,s=u),d});return!i&&r.length&&(i=r[0]),{topMatch:i,allMatches:r}}runSearch(){const{autocompleteEntries:e}=this.params,t=e.map(n=>n.displayValue??n.key);let i,s;if(this.params.useFuzzySearch)i=(0,import_core3._fuzzySuggestions)(this.searchString,t,!0).values,s=i.length?i[0]:void 0;else{const n=this.runContainsSearch(this.searchString,t);i=n.allMatches,s=n.topMatch}let a=e.filter(({key:n,displayValue:o})=>i.includes(o??n));if(!a.length&&this.selectedValue&&this.params?.forceLastSelection?.(this.selectedValue,this.searchString)&&(a=[this.selectedValue]),this.autocompleteEntries=a,this.virtualList.refresh(),!s)return;const r=i.indexOf(s);this.checkSetSelectedValue(r)}updateSearchInList(){this.virtualList.forEachRenderedRow(e=>e.setSearchString(this.searchString))}checkSetSelectedValue(e){e>=0&&e<this.autocompleteEntries.length&&this.setSelectedValue(e)}setSelectedValue(e){const t=this.autocompleteEntries[e];this.selectedValue!==t&&(this.selectedValue=t,this.virtualList.ensureIndexVisible(e),this.virtualList.forEachRenderedRow((i,s)=>{i.updateSelected(e===s)}))}createRowComponent(e){const t=new AgAutocompleteRow;return this.createBean(t),t.setState(e.displayValue??e.key,e===this.selectedValue),t}onMouseMove(e){const t=this.virtualList.getGui().getBoundingClientRect(),i=this.virtualList.getScrollTop(),s=e.clientY-t.top+i,a=Math.floor(s/this.virtualList.getRowHeight());this.checkSetSelectedValue(a)}afterGuiAttached(){this.virtualList.refresh()}getSelectedValue(){return this.autocompleteEntries.length?this.selectedValue??null:null}},AgAutocomplete=class extends import_core5.Component{constructor(){super(`
            <div class="ag-autocomplete" role="presentation">
                <ag-input-text-field data-ref="eAutocompleteInput"></ag-input-text-field>
            </div>`,[import_core5.AgInputTextFieldSelector]),this.eAutocompleteInput=import_core5.RefPlaceholder,this.isListOpen=!1,this.lastPosition=0,this.valid=!0}wireBeans(e){this.popupService=e.popupService}postConstruct(){this.eAutocompleteInput.onValueChange(e=>this.onValueChanged(e)),this.eAutocompleteInput.getInputElement().setAttribute("autocomplete","off"),this.addGuiEventListener("keydown",this.onKeyDown.bind(this)),this.addGuiEventListener("click",this.updatePositionAndList.bind(this)),this.addDestroyFunc(()=>{this.destroyBean(this.autocompleteList)}),this.addGuiEventListener("focusout",()=>this.onFocusOut())}onValueChanged(e){const t=(0,import_core5._makeNull)(e);this.updateValue(t),this.updateAutocompleteList(t)}updateValue(e){this.updateLastPosition(),this.dispatchLocalEvent({type:"eventValueChanged",value:e}),this.validate(e)}updateAutocompleteList(e){const t=this.listGenerator?.(e,this.lastPosition)??{enabled:!1};if((!t.type||t.type!==this.autocompleteListParams?.type)&&this.isListOpen&&this.closeList(),this.autocompleteListParams=t,this.autocompleteListParams?.enabled){this.isListOpen||this.openList();const{searchString:i}=this.autocompleteListParams;this.autocompleteList.setSearch(i??"")}else this.isListOpen&&this.closeList()}onKeyDown(e){const t=e.key;switch(this.updateLastPosition(),t){case import_core5.KeyCode.ENTER:this.onEnterKeyDown(e);break;case import_core5.KeyCode.TAB:this.onTabKeyDown(e);break;case import_core5.KeyCode.DOWN:case import_core5.KeyCode.UP:this.onUpDownKeyDown(e,t);break;case import_core5.KeyCode.LEFT:case import_core5.KeyCode.RIGHT:case import_core5.KeyCode.PAGE_HOME:case import_core5.KeyCode.PAGE_END:setTimeout(()=>{this.updatePositionAndList()});break;case import_core5.KeyCode.ESCAPE:this.onEscapeKeyDown(e);break;case import_core5.KeyCode.SPACE:e.ctrlKey&&!this.isListOpen&&(e.preventDefault(),this.forceOpenList());break}}confirmSelection(){const e=this.autocompleteList?.getSelectedValue();e&&(this.closeList(),this.dispatchLocalEvent({type:"eventOptionSelected",value:this.getValue(),position:this.lastPosition,updateEntry:e,autocompleteType:this.autocompleteListParams.type}))}onTabKeyDown(e){this.isListOpen&&(e.preventDefault(),e.stopPropagation(),this.confirmSelection())}onEnterKeyDown(e){e.preventDefault(),this.isListOpen?this.confirmSelection():this.onCompleted()}onUpDownKeyDown(e,t){e.preventDefault(),this.isListOpen?this.autocompleteList?.onNavigationKeyDown(e,t):this.forceOpenList()}onEscapeKeyDown(e){this.isListOpen&&(e.preventDefault(),e.stopPropagation(),this.closeList(),this.setCaret(this.lastPosition,!0))}onFocusOut(){this.isListOpen&&this.closeList()}updatePositionAndList(){this.updateLastPosition(),this.updateAutocompleteList(this.eAutocompleteInput.getValue()??null)}setCaret(e,t){const i=this.gos.getDocument(),s=this.gos.getActiveDomElement();t&&(!s||s===i.body)&&this.eAutocompleteInput.getFocusableElement().focus();const a=this.eAutocompleteInput.getInputElement();a.setSelectionRange(e,e),e===a.value.length&&(a.scrollLeft=a.scrollWidth)}forceOpenList(){this.onValueChanged(this.eAutocompleteInput.getValue())}updateLastPosition(){this.lastPosition=this.eAutocompleteInput.getInputElement().selectionStart??0}validate(e){this.validator&&(this.validationMessage=this.validator(e),this.eAutocompleteInput.getInputElement().setCustomValidity(this.validationMessage??""),this.valid=!this.validationMessage,this.dispatchLocalEvent({type:"eventValidChanged",isValid:this.valid,validationMessage:this.validationMessage}))}openList(){this.isListOpen=!0,this.autocompleteList=this.createBean(new AgAutocompleteList({autocompleteEntries:this.autocompleteListParams.entries,onConfirmed:()=>this.confirmSelection(),forceLastSelection:this.forceLastSelection}));const e=this.autocompleteList.getGui(),t={ePopup:e,type:"autocomplete",eventSource:this.getGui(),position:"under",alignSide:this.gos.get("enableRtl")?"right":"left",keepWithinBounds:!0},i=this.popupService.addPopup({eChild:e,anchorToElement:this.getGui(),positionCallback:()=>this.popupService.positionPopupByComponent(t),ariaLabel:this.listAriaLabel});this.hidePopup=i.hideFunc,this.autocompleteList.afterGuiAttached()}closeList(){this.isListOpen=!1,this.hidePopup(),this.destroyBean(this.autocompleteList),this.autocompleteList=null}onCompleted(){this.isListOpen&&this.closeList(),this.dispatchLocalEvent({type:"eventValueConfirmed",value:this.getValue(),isValid:this.isValid()})}getValue(){return(0,import_core5._makeNull)(this.eAutocompleteInput.getValue())}setInputPlaceholder(e){return this.eAutocompleteInput.setInputPlaceholder(e),this}setInputAriaLabel(e){return this.eAutocompleteInput.setInputAriaLabel(e),this}setListAriaLabel(e){return this.listAriaLabel=e,this}setListGenerator(e){return this.listGenerator=e,this}setValidator(e){return this.validator=e,this}isValid(){return this.valid}setValue(e){const{value:t,position:i,silent:s,updateListOnlyIfOpen:a,restoreFocus:r}=e;this.eAutocompleteInput.setValue(t,!0),this.setCaret(i??this.lastPosition,r),s||this.updateValue(t),(!a||this.isListOpen)&&this.updateAutocompleteList(t)}setForceLastSelection(e){return this.forceLastSelection=e,this}setInputDisabled(e){return this.eAutocompleteInput.setDisabled(e),this}},AgAutocompleteSelector={selector:"AG-AUTOCOMPLETE",component:AgAutocomplete},AdvancedFilterComp=class extends import_core6.Component{constructor(){super(`
            <div class="ag-advanced-filter" role="presentation" tabindex="-1">
                <ag-autocomplete data-ref="eAutocomplete"></ag-autocomplete>
                <button class="ag-button ag-standard-button ag-advanced-filter-apply-button" data-ref="eApplyFilterButton"></button>
                <button class="ag-advanced-filter-builder-button" data-ref="eBuilderFilterButton">
                    <span data-ref="eBuilderFilterButtonIcon" aria-hidden="true"></span>
                    <span class="ag-advanced-filter-builder-button-label" data-ref="eBuilderFilterButtonLabel"></span>
                </button>
            </div>`,[AgAutocompleteSelector]),this.eAutocomplete=import_core6.RefPlaceholder,this.eApplyFilterButton=import_core6.RefPlaceholder,this.eBuilderFilterButton=import_core6.RefPlaceholder,this.eBuilderFilterButtonIcon=import_core6.RefPlaceholder,this.eBuilderFilterButtonLabel=import_core6.RefPlaceholder,this.expressionParser=null,this.isApplyDisabled=!0,this.builderOpen=!1}wireBeans(e){this.advancedFilterExpressionService=e.advancedFilterExpressionService,this.advancedFilterService=e.advancedFilterService,this.filterManager=e.filterManager}postConstruct(){this.eAutocomplete.setListGenerator((e,t)=>this.generateAutocompleteListParams(t)).setValidator(()=>this.validateValue()).setForceLastSelection((e,t)=>this.forceLastSelection(e,t)).setInputAriaLabel(this.advancedFilterExpressionService.translate("ariaAdvancedFilterInput")).setListAriaLabel(this.advancedFilterExpressionService.translate("ariaLabelAdvancedFilterAutocomplete")),this.refresh(),this.addManagedListeners(this.eAutocomplete,{eventValueChanged:({value:e})=>this.onValueChanged(e),eventValueConfirmed:({isValid:e})=>this.onValueConfirmed(e),eventOptionSelected:({position:e,updateEntry:t,autocompleteType:i})=>this.onOptionSelected(e,t,i),eventValidChanged:({isValid:e,validationMessage:t})=>this.onValidChanged(e,t)}),this.setupApplyButton(),this.setupBuilderButton()}refresh(){const e=this.advancedFilterService.getExpressionDisplayValue();this.eAutocomplete.setValue({value:e??"",position:e?.length,updateListOnlyIfOpen:!0})}setInputDisabled(e){this.eAutocomplete.setInputDisabled(e),(0,import_core6._setDisabled)(this.eApplyFilterButton,e||this.isApplyDisabled)}getTooltipParams(){const e=super.getTooltipParams();return e.location="advancedFilter",e}setupApplyButton(){this.eApplyFilterButton.innerText=this.advancedFilterExpressionService.translate("advancedFilterApply"),this.activateTabIndex([this.eApplyFilterButton]),this.addManagedElementListeners(this.eApplyFilterButton,{click:()=>this.onValueConfirmed(this.eAutocomplete.isValid())}),(0,import_core6._setDisabled)(this.eApplyFilterButton,this.isApplyDisabled)}setupBuilderButton(){this.eBuilderFilterButtonIcon.appendChild((0,import_core6._createIconNoSpan)("advancedFilterBuilder",this.gos)),this.eBuilderFilterButtonLabel.innerText=this.advancedFilterExpressionService.translate("advancedFilterBuilder"),this.activateTabIndex([this.eBuilderFilterButton]),this.addManagedElementListeners(this.eBuilderFilterButton,{click:()=>this.openBuilder()}),this.addManagedListeners(this.advancedFilterService.getCtrl(),{advancedFilterBuilderClosed:()=>this.closeBuilder()})}onValueChanged(e){e=(0,import_core6._makeNull)(e),this.advancedFilterService.setExpressionDisplayValue(e),this.expressionParser=this.advancedFilterService.createExpressionParser(e);const t=this.expressionParser?.parseExpression();t&&t!==e&&this.eAutocomplete.setValue({value:t,silent:!0,restoreFocus:!0})}onValueConfirmed(e){!e||this.isApplyDisabled||((0,import_core6._setDisabled)(this.eApplyFilterButton,!0),this.advancedFilterService.applyExpression(),this.filterManager?.onFilterChanged({source:"advancedFilter"}))}onOptionSelected(e,t,i){const{updatedValue:s,updatedPosition:a,hideAutocomplete:r}=this.updateExpression(e,t,i);this.eAutocomplete.setValue({value:s,position:a,updateListOnlyIfOpen:r,restoreFocus:!0})}validateValue(){return this.expressionParser?.isValid()?null:this.expressionParser?.getValidationMessage()??null}onValidChanged(e,t){this.isApplyDisabled=!e||this.advancedFilterService.isCurrentExpressionApplied(),(0,import_core6._setDisabled)(this.eApplyFilterButton,this.isApplyDisabled),this.setTooltip({newTooltipText:t,showDelayOverride:1e3})}generateAutocompleteListParams(e){return this.expressionParser?this.expressionParser.getAutocompleteListParams(e):this.advancedFilterExpressionService.getDefaultAutocompleteListParams("")}updateExpression(e,t,i){return this.advancedFilterExpressionService.updateAutocompleteCache(t,i),this.expressionParser?.updateExpression(e,t,i)??this.advancedFilterService.getDefaultExpression(t)}forceLastSelection({key:e,displayValue:t},i){return!!i.toLocaleLowerCase().match(`^${(t??e).toLocaleLowerCase()}\\s*$`)}openBuilder(){this.builderOpen||(this.builderOpen=!0,(0,import_core6._setDisabled)(this.eBuilderFilterButton,!0),this.advancedFilterService.getCtrl().toggleFilterBuilder("ui"))}closeBuilder(){this.builderOpen&&(this.builderOpen=!1,(0,import_core6._setDisabled)(this.eBuilderFilterButton,!1),this.eBuilderFilterButton.focus())}},import_core7=require("@ag-grid-community/core"),AdvancedFilterHeaderComp=class extends import_core7.Component{constructor(e){super(`
            <div class="ag-advanced-filter-header" role="row">
            </div>`),this.enabled=e}wireBeans(e){this.columnModel=e.columnModel,this.focusService=e.focusService,this.headerNavigationService=e.headerNavigationService}postConstruct(){this.setupAdvancedFilter(this.enabled),this.addDestroyFunc(()=>this.destroyBean(this.eAdvancedFilter));const e=()=>{this.enabled&&this.setEnabledHeight()};this.addManagedEventListeners({gridColumnsChanged:()=>this.onGridColumnsChanged(),columnHeaderHeightChanged:e,gridStylesChanged:e}),this.addManagedPropertyListener("headerHeight",e),this.addManagedPropertyListener("floatingFiltersHeight",e),this.addGuiEventListener("keydown",t=>this.onKeyDown(t)),this.addGuiEventListener("focusout",t=>{this.getFocusableElement().contains(t.relatedTarget)||this.focusService.clearAdvancedFilterColumn()})}getFocusableElement(){return this.eAdvancedFilter?.getGui()??this.getGui()}setEnabled(e){e!==this.enabled&&this.setupAdvancedFilter(e)}refresh(){this.eAdvancedFilter?.refresh()}getHeight(){return this.height}setInputDisabled(e){this.eAdvancedFilter?.setInputDisabled(e)}setupAdvancedFilter(e){const t=this.getGui();if(e){this.eAdvancedFilter=this.createBean(new AdvancedFilterComp);const i=this.eAdvancedFilter.getGui();this.eAdvancedFilter.addCssClass("ag-advanced-filter-header-cell"),this.setEnabledHeight(),this.setAriaRowIndex(),(0,import_core7._setAriaRole)(i,"gridcell"),(0,import_core7._setAriaColIndex)(i,1),this.setAriaColumnCount(i),t.appendChild(i)}else(0,import_core7._clearElement)(t),this.destroyBean(this.eAdvancedFilter),this.height=0;(0,import_core7._setDisplayed)(t,e),this.enabled=e}setEnabledHeight(){const e=this.getGui();this.height=this.columnModel.getFloatingFiltersHeight();const t=`${this.height}px`;e.style.height=t,e.style.minHeight=t}setAriaColumnCount(e){(0,import_core7._setAriaColSpan)(e,this.columnModel.getCols().length)}setAriaRowIndex(){(0,import_core7._setAriaRowIndex)(this.getGui(),this.headerNavigationService.getHeaderRowCount())}onGridColumnsChanged(){this.eAdvancedFilter&&(this.setAriaColumnCount(this.eAdvancedFilter.getGui()),this.setAriaRowIndex())}onKeyDown(e){switch(e.key){case import_core7.KeyCode.ENTER:{this.hasFocus()&&this.focusService.focusInto(this.getFocusableElement())&&e.preventDefault();break}case import_core7.KeyCode.ESCAPE:this.hasFocus()||this.getFocusableElement().focus();break;case import_core7.KeyCode.UP:this.navigateUpDown(!0,e);break;case import_core7.KeyCode.DOWN:this.navigateUpDown(!1,e);break;case import_core7.KeyCode.TAB:if(this.hasFocus())this.navigateLeftRight(e);else{const t=this.focusService.findNextFocusableElement(this.getFocusableElement(),null,e.shiftKey);t?(e.preventDefault(),t.focus()):this.navigateLeftRight(e)}break}}navigateUpDown(e,t){this.hasFocus()&&this.focusService.focusNextFromAdvancedFilter(e)&&t.preventDefault()}navigateLeftRight(e){(e.shiftKey?this.focusService.focusLastHeader():this.focusService.focusNextFromAdvancedFilter(!1,!0))&&e.preventDefault()}hasFocus(){return this.gos.getActiveDomElement()===this.getFocusableElement()}},import_core20=require("@ag-grid-community/core"),import_core21=require("@ag-grid-enterprise/core"),import_core8=require("@ag-grid-community/core"),import_core9=require("@ag-grid-enterprise/core"),AdvancedFilterBuilderDragFeature=class extends import_core8.BeanStub{constructor(e,t){super(),this.comp=e,this.virtualList=t}postConstruct(){this.createManagedBean(new import_core9.VirtualListDragFeature(this.comp,this.virtualList,{dragSourceType:import_core8.DragSourceType.AdvancedFilterBuilder,listItemDragStartEvent:"advancedFilterBuilderDragStarted",listItemDragEndEvent:"advancedFilterBuilderDragEnded",eventSource:this,getCurrentDragValue:e=>this.getCurrentDragValue(e),isMoveBlocked:()=>!1,getNumRows:e=>e.getNumItems(),moveItem:(e,t)=>this.moveItem(e,t)}))}getCurrentDragValue(e){return e.item}moveItem(e,t){this.comp.moveItem(e,t)}},import_core13=require("@ag-grid-community/core"),import_core10=require("@ag-grid-community/core"),import_core11=require("@ag-grid-enterprise/core"),AddDropdownComp=class extends import_core11.AgRichSelect{constructor(e){super({...e,template:`
                <div class="ag-picker-field" role="presentation">
                    <div data-ref="eLabel"></div>
                    <div data-ref="eWrapper" class="ag-wrapper ag-picker-collapsed">
                        <div data-ref="eDisplayField" class="ag-picker-field-display"></div>
                        <ag-input-text-field data-ref="eInput" class="ag-rich-select-field-input"></ag-input-text-field>
                        <span data-ref="eDeselect" class="ag-rich-select-deselect-button ag-picker-field-icon" role="presentation"></span>
                        <div data-ref="eIcon" class="ag-picker-field-icon" aria-hidden="true"></div>
                    </div>
                </div>`,agComponents:[import_core10.AgInputTextFieldSelector]}),this.params=e}showPicker(){setTimeout(()=>super.showPicker())}hidePicker(){setTimeout(()=>super.hidePicker())}postConstruct(){super.postConstruct();const{wrapperClassName:e,ariaLabel:t}=this.params;(0,import_core10._setDisplayed)(this.eDisplayField,!1),e&&this.eWrapper.classList.add(e),(0,import_core10._setAriaLabelledBy)(this.eWrapper,""),(0,import_core10._setAriaLabel)(this.eWrapper,t)}onEnterKeyDown(e){(0,import_core10._stopPropagationForAgGrid)(e),this.isPickerDisplayed?super.onEnterKeyDown(e):(e.preventDefault(),this.showPicker())}},import_core12=require("@ag-grid-community/core"),AdvancedFilterBuilderItemNavigationFeature=class extends import_core12.BeanStub{constructor(e,t,i){super(),this.eGui=e,this.focusWrapper=t,this.eFocusableComp=i}postConstruct(){this.addManagedElementListeners(this.eGui,{keydown:t=>{switch(t.key){case import_core12.KeyCode.TAB:t.defaultPrevented||(0,import_core12._stopPropagationForAgGrid)(t);break;case import_core12.KeyCode.UP:case import_core12.KeyCode.DOWN:(0,import_core12._stopPropagationForAgGrid)(t);break;case import_core12.KeyCode.ESCAPE:if((0,import_core12._isStopPropagationForAgGrid)(t))return;this.eGui.contains(this.gos.getActiveDomElement())&&(t.preventDefault(),(0,import_core12._stopPropagationForAgGrid)(t),this.focusWrapper.focus());break}}});const e="ag-advanced-filter-builder-virtual-list-item-highlight";this.addManagedListeners(this.focusWrapper,{keydown:t=>{switch(t.key){case import_core12.KeyCode.ENTER:if((0,import_core12._isStopPropagationForAgGrid)(t))return;this.gos.getActiveDomElement()===this.focusWrapper&&(t.preventDefault(),(0,import_core12._stopPropagationForAgGrid)(t),this.eFocusableComp.getFocusableElement().focus());break}},focusin:()=>{this.focusWrapper.classList.add(e)},focusout:t=>{this.focusWrapper.contains(t.relatedTarget)||this.focusWrapper.classList.remove(e)}})}};function getAdvancedFilterBuilderAddButtonParams(e,t){return{pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderAddField",pickerAriaLabelValue:"Advanced Filter Builder Add Field",pickerType:"ag-list",valueList:[{key:"condition",displayValue:e("advancedFilterBuilderAddCondition")},{key:"join",displayValue:e("advancedFilterBuilderAddJoin")}],valueFormatter:i=>i==null?null:i.displayValue??i.key,pickerIcon:"advancedFilterBuilderAdd",maxPickerWidth:`${t??120}px`,wrapperClassName:"ag-advanced-filter-builder-item-button",ariaLabel:e("advancedFilterBuilderAddButtonTooltip")}}var AdvancedFilterBuilderItemAddComp=class extends import_core13.Component{constructor(e,t){super(`
            <div class="ag-advanced-filter-builder-item-wrapper" role="presentation">
                <div data-ref="eItem" class="ag-advanced-filter-builder-item" role="presentation">
                    <div class="ag-advanced-filter-builder-item-tree-lines" aria-hidden="true">
                        <div class="ag-advanced-filter-builder-item-tree-line-vertical-top ag-advanced-filter-builder-item-tree-line-horizontal"></div>
                    </div>
                </div>
            </div>
        `),this.item=e,this.focusWrapper=t,this.eItem=import_core13.RefPlaceholder}wireBeans(e){this.advancedFilterExpressionService=e.advancedFilterExpressionService}postConstruct(){(0,import_core13._setAriaLevel)(this.focusWrapper,2);const e=getAdvancedFilterBuilderAddButtonParams(i=>this.advancedFilterExpressionService.translate(i),this.gos.get("advancedFilterBuilderParams")?.addSelectWidth),t=this.createManagedBean(new AddDropdownComp(e));this.addManagedListeners(t,{fieldPickerValueSelected:({value:i})=>{this.dispatchLocalEvent({type:"advancedFilterBuilderAdded",item:this.item,isJoin:i.key==="join"})}}),this.eItem.appendChild(t.getGui()),this.createManagedBean(new import_core13.TooltipFeature({getGui:()=>t.getGui(),getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advancedFilterExpressionService.translate("advancedFilterBuilderAddButtonTooltip")})),this.createManagedBean(new AdvancedFilterBuilderItemNavigationFeature(this.getGui(),this.focusWrapper,t)),(0,import_core13._setAriaLabel)(this.focusWrapper,this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderItem",[this.advancedFilterExpressionService.translate("advancedFilterBuilderAddButtonTooltip"),`${this.item.level+1}`]))}afterAdd(){}},import_core19=require("@ag-grid-community/core"),import_core14=require("@ag-grid-community/core"),ConditionPillWrapperComp=class extends import_core14.Component{constructor(){super(`
            <div class="ag-advanced-filter-builder-item-condition" role="presentation"></div>
        `),this.validationMessage=null}wireBeans(e){this.advancedFilterExpressionService=e.advancedFilterExpressionService}init(e){const{item:t,createPill:i}=e;this.item=t,this.createPill=i,this.filterModel=t.filterModel,this.setupColumnCondition(this.filterModel),this.validate(),this.addDestroyFunc(()=>this.destroyBeans([this.eColumnPill,this.eOperatorPill,this.eOperandPill]))}getDragName(){return this.filterModel.colId?this.advancedFilterExpressionService.parseColumnFilterModel(this.filterModel):this.getDefaultColumnDisplayValue()}getAriaLabel(){return`${this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderFilterItem")} ${this.getDragName()}`}getValidationMessage(){return this.validationMessage}getFocusableElement(){return this.eColumnPill.getFocusableElement()}setupColumnCondition(e){const t=this.advancedFilterExpressionService.getColumnDetails(e.colId);this.baseCellDataType=t.baseCellDataType,this.column=t.column,this.numOperands=this.getNumOperands(this.getOperatorKey()),this.eColumnPill=this.createPill({key:this.getColumnKey(),displayValue:this.getColumnDisplayValue()??this.getDefaultColumnDisplayValue(),cssClass:"ag-advanced-filter-builder-column-pill",isSelect:!0,getEditorParams:()=>({values:this.advancedFilterExpressionService.getColumnAutocompleteEntries()}),update:i=>this.setColumnKey(i),pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderColumnSelectField",pickerAriaLabelValue:"Advanced Filter Builder Column Select Field",ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderColumn")}),this.getGui().appendChild(this.eColumnPill.getGui()),(0,import_core14._exists)(this.getColumnKey())&&(this.createOperatorPill(),this.hasOperand()&&this.createOperandPill())}createOperatorPill(){this.eOperatorPill=this.createPill({key:this.getOperatorKey(),displayValue:this.getOperatorDisplayValue()??this.getDefaultOptionSelectValue(),cssClass:"ag-advanced-filter-builder-option-pill",isSelect:!0,getEditorParams:()=>({values:this.getOperatorAutocompleteEntries()}),update:e=>this.setOperatorKey(e),pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderOptionSelectField",pickerAriaLabelValue:"Advanced Filter Builder Option Select Field",ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderOption")}),this.eColumnPill.getGui().insertAdjacentElement("afterend",this.eOperatorPill.getGui())}createOperandPill(){const e=this.getOperandDisplayValue()??"";this.eOperandPill=this.createPill({key:e,displayValue:e,baseCellDataType:this.baseCellDataType,cssClass:"ag-advanced-filter-builder-value-pill",isSelect:!1,update:t=>this.setOperand(t),ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderValue")}),this.getGui().appendChild(this.eOperandPill.getGui())}getColumnKey(){return this.filterModel.colId}getColumnDisplayValue(){return this.advancedFilterExpressionService.getColumnDisplayValue(this.filterModel)}getOperatorKey(){return this.filterModel.type}getOperatorDisplayValue(){return this.advancedFilterExpressionService.getOperatorDisplayValue(this.filterModel)}getOperandDisplayValue(){return this.advancedFilterExpressionService.getOperandDisplayValue(this.filterModel,!0)}hasOperand(){return this.numOperands>0}getOperatorAutocompleteEntries(){return this.column?this.advancedFilterExpressionService.getOperatorAutocompleteEntries(this.column,this.baseCellDataType):[]}setColumnKey(e){this.eOperatorPill||this.createOperatorPill();const t=this.advancedFilterExpressionService.getColumnDetails(e);this.column=t.column;const i=t.baseCellDataType;this.baseCellDataType!==i&&(this.baseCellDataType=i,this.setOperatorKey(void 0),this.eOperatorPill&&((0,import_core14._removeFromParent)(this.eOperatorPill.getGui()),this.destroyBean(this.eOperatorPill),this.createOperatorPill()),this.validate()),this.filterModel.colId=e,this.filterModel.filterType=this.baseCellDataType}setOperatorKey(e){const t=this.getNumOperands(e);t!==this.numOperands&&(this.numOperands=t,t===0?this.destroyOperandPill():(this.createOperandPill(),this.baseCellDataType!=="number"&&this.setOperand(""))),this.filterModel.type=e,this.validate()}setOperand(e){let t=e;this.column&&(t=this.advancedFilterExpressionService.getOperandModelValue(e,this.baseCellDataType,this.column)??""),this.filterModel.filter=t,this.validate()}getNumOperands(e){return this.advancedFilterExpressionService.getExpressionOperator(this.baseCellDataType,e)?.numOperands??0}destroyOperandPill(){delete this.filterModel.filter,this.getGui().removeChild(this.eOperandPill.getGui()),this.destroyBean(this.eOperandPill),this.eOperandPill=void 0}validate(){let e=null;(0,import_core14._exists)(this.getColumnKey())?(0,import_core14._exists)(this.getOperatorKey())?this.numOperands>0&&!(0,import_core14._exists)(this.getOperandDisplayValue())&&(e=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationEnterValue")):e=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationSelectOption"):e=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationSelectColumn"),this.item.valid=!e,e!==this.validationMessage&&(this.validationMessage=e,this.dispatchLocalEvent({type:"advancedFilterBuilderValidChanged"}))}getDefaultColumnDisplayValue(){return this.advancedFilterExpressionService.translate("advancedFilterBuilderSelectColumn")}getDefaultOptionSelectValue(){return this.advancedFilterExpressionService.translate("advancedFilterBuilderSelectOption")}},import_core15=require("@ag-grid-community/core"),InputPillComp=class extends import_core15.Component{constructor(e){super(`
            <div class="ag-advanced-filter-builder-pill-wrapper" role="presentation">
                <div data-ref="ePill" class="ag-advanced-filter-builder-pill" role="button">
                    <span data-ref="eLabel" class="ag-advanced-filter-builder-pill-display"></span>
                </div>
            </div>
        `),this.params=e,this.ePill=import_core15.RefPlaceholder,this.eLabel=import_core15.RefPlaceholder,this.value=e.value}wireBeans(e){this.advancedFilterExpressionService=e.advancedFilterExpressionService}postConstruct(){const{cssClass:e,ariaLabel:t}=this.params;this.ePill.classList.add(e),this.activateTabIndex([this.ePill]),this.eLabel.id=`${this.getCompId()}`,(0,import_core15._setAriaDescribedBy)(this.ePill,this.eLabel.id),(0,import_core15._setAriaLabel)(this.ePill,t),this.renderValue(),this.addManagedListeners(this.ePill,{click:i=>{i.preventDefault(),this.showEditor()},keydown:i=>{switch(i.key){case import_core15.KeyCode.ENTER:i.preventDefault(),(0,import_core15._stopPropagationForAgGrid)(i),this.showEditor();break}}}),this.addDestroyFunc(()=>this.destroyBean(this.eEditor))}getFocusableElement(){return this.ePill}showEditor(){if(this.eEditor)return;(0,import_core15._setDisplayed)(this.ePill,!1),this.eEditor=this.createEditorComp(this.params.type),this.eEditor.setValue(this.value);const e=this.eEditor.getGui();this.eEditor.addManagedElementListeners(e,{keydown:t=>{switch(t.key){case import_core15.KeyCode.ENTER:t.preventDefault(),(0,import_core15._stopPropagationForAgGrid)(t),this.updateValue(!0);break;case import_core15.KeyCode.ESCAPE:t.preventDefault(),(0,import_core15._stopPropagationForAgGrid)(t),this.hideEditor(!0);break}},focusout:()=>this.updateValue(!1)}),this.getGui().appendChild(e),this.eEditor.getFocusableElement().focus()}createEditorComp(e){let t;switch(e){case"text":t=new import_core15.AgInputTextField;break;case"number":t=new import_core15.AgInputNumberField;break;case"date":t=new import_core15.AgInputDateField;break}return this.createBean(t)}hideEditor(e){const{eEditor:t}=this;t&&(this.eEditor=void 0,this.getGui().removeChild(t.getGui()),this.destroyBean(t),(0,import_core15._setDisplayed)(this.ePill,!0),e&&this.ePill.focus())}renderValue(){let e;this.eLabel.classList.remove("ag-advanced-filter-builder-value-empty","ag-advanced-filter-builder-value-number","ag-advanced-filter-builder-value-text"),(0,import_core15._exists)(this.value)?this.params.type==="number"?(e=this.value,this.eLabel.classList.add("ag-advanced-filter-builder-value-number")):(e=`"${this.value}"`,this.eLabel.classList.add("ag-advanced-filter-builder-value-text")):(e=this.advancedFilterExpressionService.translate("advancedFilterBuilderEnterValue"),this.eLabel.classList.add("ag-advanced-filter-builder-value-empty")),this.eLabel.innerText=e}updateValue(e){if(!this.eEditor)return;const t=this.eEditor.getValue()??"";this.dispatchLocalEvent({type:"fieldValueChanged",value:t}),this.value=t,this.renderValue(),this.hideEditor(e)}},import_core16=require("@ag-grid-community/core"),JoinPillWrapperComp=class extends import_core16.Component{wireBeans(e){this.advancedFilterExpressionService=e.advancedFilterExpressionService}constructor(){super(`
            <div class="ag-advanced-filter-builder-item-condition" role="presentation"></div>
        `)}init(e){const{item:t,createPill:i}=e,s=t.filterModel;this.filterModel=s,this.ePill=i({key:s.type,displayValue:this.advancedFilterExpressionService.parseJoinOperator(s),cssClass:"ag-advanced-filter-builder-join-pill",isSelect:!0,getEditorParams:()=>({values:this.advancedFilterExpressionService.getJoinOperatorAutocompleteEntries()}),update:a=>s.type=a,pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderJoinSelectField",pickerAriaLabelValue:"Advanced Filter Builder Join Operator Select Field",ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderJoinOperator")}),this.getGui().appendChild(this.ePill.getGui()),this.addDestroyFunc(()=>this.destroyBean(this.ePill))}getDragName(){return this.advancedFilterExpressionService.parseJoinOperator(this.filterModel)}getAriaLabel(){return`${this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderGroupItem")} ${this.getDragName()}`}getValidationMessage(){return null}getFocusableElement(){return this.ePill.getFocusableElement()}},import_core17=require("@ag-grid-community/core"),import_core18=require("@ag-grid-enterprise/core"),SelectPillComp=class extends import_core18.AgRichSelect{constructor(e){super({...e,template:`
                <div class="ag-picker-field ag-advanced-filter-builder-pill-wrapper" role="presentation">
                    <div data-ref="eLabel"></div>
                    <div data-ref="eWrapper" class="ag-wrapper ag-advanced-filter-builder-pill ag-picker-collapsed">
                        <div data-ref="eDisplayField" class="ag-picker-field-display ag-advanced-filter-builder-pill-display"></div>
                        <ag-input-text-field data-ref="eInput" class="ag-rich-select-field-input"></ag-input-text-field>
                        <span data-ref="eDeselect" class="ag-rich-select-deselect-button ag-picker-field-icon" role="presentation"></span>
                        <div data-ref="eIcon" class="ag-picker-field-icon" aria-hidden="true"></div>
                    </div>
                </div>`,agComponents:[import_core17.AgInputTextFieldSelector]}),this.params=e}getFocusableElement(){return this.eWrapper}showPicker(){setTimeout(()=>super.showPicker())}hidePicker(){setTimeout(()=>super.hidePicker())}postConstruct(){super.postConstruct();const{wrapperClassName:e,ariaLabel:t}=this.params;this.eWrapper.classList.add(e),(0,import_core17._setAriaLabelledBy)(this.eWrapper,""),(0,import_core17._setAriaLabel)(this.eWrapper,t)}createPickerComponent(){if(!this.values){const{values:e}=this.params.getEditorParams();this.values=e;const t=this.value.key,i=e.find(s=>s.key===t)??{key:t,displayValue:this.value.displayValue};this.value=i}return super.createPickerComponent()}onEnterKeyDown(e){(0,import_core17._stopPropagationForAgGrid)(e),this.isPickerDisplayed?super.onEnterKeyDown(e):(e.preventDefault(),this.showPicker())}},AdvancedFilterBuilderItemComp=class extends import_core19.TabGuardComp{constructor(e,t,i){super(`
            <div class="ag-advanced-filter-builder-item-wrapper" role="presentation">
                <div class="ag-advanced-filter-builder-item" role="presentation">
                    <div data-ref="eTreeLines" class="ag-advanced-filter-builder-item-tree-lines" aria-hidden="true"></div>
                    <span data-ref="eDragHandle" class="ag-drag-handle" aria-hidden="true"></span>
                    <span data-ref="eValidation" class="ag-advanced-filter-builder-item-button ag-advanced-filter-builder-invalid" aria-hidden="true"></span>
                </div>
                <div data-ref="eButtons" class="ag-advanced-filter-builder-item-buttons">
                    <span data-ref="eMoveUpButton" class="ag-advanced-filter-builder-item-button" role="button"></span>
                    <span data-ref="eMoveDownButton" class="ag-advanced-filter-builder-item-button" role="button"></span>
                    <div data-ref="eAddButton" role="presentation"></div>
                    <span data-ref="eRemoveButton" class="ag-advanced-filter-builder-item-button" role="button"></span>
                </div>
            </div>
        `),this.item=e,this.dragFeature=t,this.focusWrapper=i,this.eTreeLines=import_core19.RefPlaceholder,this.eDragHandle=import_core19.RefPlaceholder,this.eButtons=import_core19.RefPlaceholder,this.eValidation=import_core19.RefPlaceholder,this.eMoveUpButton=import_core19.RefPlaceholder,this.eMoveDownButton=import_core19.RefPlaceholder,this.eAddButton=import_core19.RefPlaceholder,this.eRemoveButton=import_core19.RefPlaceholder,this.moveUpDisabled=!1,this.moveDownDisabled=!1}wireBeans(e){this.dragAndDropService=e.dragAndDropService,this.advancedFilterExpressionService=e.advancedFilterExpressionService}postConstruct(){const{filterModel:e,level:t,showMove:i}=this.item,s=e.filterType==="join";if(this.ePillWrapper=this.createManagedBean(s?new JoinPillWrapperComp:new ConditionPillWrapperComp),this.ePillWrapper.init({item:this.item,createPill:a=>this.createPill(a)}),this.eDragHandle.insertAdjacentElement("afterend",this.ePillWrapper.getGui()),t===0){const a=document.createElement("div");a.classList.add("ag-advanced-filter-builder-item-tree-line-vertical-bottom"),a.classList.add("ag-advanced-filter-builder-item-tree-line-root"),this.eTreeLines.appendChild(a),(0,import_core19._setDisplayed)(this.eDragHandle,!1),(0,import_core19._setDisplayed)(this.eButtons,!1),(0,import_core19._setAriaExpanded)(this.focusWrapper,!0)}else this.setupTreeLines(t),this.eDragHandle.appendChild((0,import_core19._createIconNoSpan)("advancedFilterBuilderDrag",this.gos)),this.setupValidation(),this.setupMoveButtons(i),this.setupAddButton(),this.setupRemoveButton(),this.setupDragging(),this.updateAriaExpanded();(0,import_core19._setAriaLevel)(this.focusWrapper,t+1),this.initialiseTabGuard({}),this.createManagedBean(new AdvancedFilterBuilderItemNavigationFeature(this.getGui(),this.focusWrapper,this.ePillWrapper)),this.updateAriaLabel(),this.addManagedListeners(this.ePillWrapper,{advancedFilterBuilderValueChanged:()=>this.dispatchLocalEvent({type:"advancedFilterBuilderValueChanged"}),advancedFilterBuilderValidChanged:()=>this.updateValidity()})}setState(e){const{level:t}=this.item;if(t===0)return;const{showMove:i}=this.item,{disableMoveUp:s,disableMoveDown:a,treeLines:r,showStartTreeLine:n}=e;this.updateTreeLines(r,n),this.updateAriaExpanded(),i&&(this.moveUpDisabled=!!s,this.moveDownDisabled=!!a,this.eMoveUpButton.classList.toggle("ag-advanced-filter-builder-item-button-disabled",s),this.eMoveDownButton.classList.toggle("ag-advanced-filter-builder-item-button-disabled",a),(0,import_core19._setAriaDisabled)(this.eMoveUpButton,!!s),(0,import_core19._setAriaDisabled)(this.eMoveDownButton,!!a),this.moveUpTooltipFeature.refreshToolTip(),this.moveDownTooltipFeature.refreshToolTip())}focusMoveButton(e){(e?this.eMoveUpButton:this.eMoveDownButton).focus()}afterAdd(){this.ePillWrapper.getFocusableElement().focus()}setupTreeLines(e){for(let t=0;t<e;t++){const i=document.createElement("div");this.eTreeLines.appendChild(i)}}updateTreeLines(e,t){const i=e.length-1,{children:s}=this.eTreeLines;for(let r=0;r<i;r++){const n=s.item(r);n&&n.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical",!e[r])}const a=s.item(i);if(a){a.classList.add("ag-advanced-filter-builder-item-tree-line-horizontal");const r=e[i];a.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical-top",r),a.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical",!r)}this.eDragHandle.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical-bottom",t)}setupValidation(){this.eValidation.appendChild((0,import_core19._createIconNoSpan)("advancedFilterBuilderInvalid",this.gos)),this.validationTooltipFeature=this.createManagedBean(new import_core19.TooltipFeature({getGui:()=>this.eValidation,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.ePillWrapper.getValidationMessage(),getTooltipShowDelayOverride:()=>1e3})),this.updateValidity()}setupAddButton(){const e=getAdvancedFilterBuilderAddButtonParams(i=>this.advancedFilterExpressionService.translate(i),this.gos.get("advancedFilterBuilderParams")?.addSelectWidth),t=this.createManagedBean(new AddDropdownComp(e));this.addManagedListeners(t,{fieldPickerValueSelected:({value:i})=>this.dispatchLocalEvent({type:"advancedFilterBuilderAdded",item:this.item,isJoin:i.key==="join"})}),this.eAddButton.appendChild(t.getGui()),this.createManagedBean(new import_core19.TooltipFeature({getGui:()=>this.eAddButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advancedFilterExpressionService.translate("advancedFilterBuilderAddButtonTooltip")}))}setupRemoveButton(){this.eRemoveButton.appendChild((0,import_core19._createIconNoSpan)("advancedFilterBuilderRemove",this.gos)),this.addManagedListeners(this.eRemoveButton,{click:()=>this.removeItem(),keydown:e=>{switch(e.key){case import_core19.KeyCode.ENTER:e.preventDefault(),(0,import_core19._stopPropagationForAgGrid)(e),this.removeItem();break}}}),this.createManagedBean(new import_core19.TooltipFeature({getGui:()=>this.eRemoveButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advancedFilterExpressionService.translate("advancedFilterBuilderRemoveButtonTooltip")})),(0,import_core19._setAriaLabel)(this.eRemoveButton,this.advancedFilterExpressionService.translate("advancedFilterBuilderRemoveButtonTooltip")),this.activateTabIndex([this.eRemoveButton])}setupMoveButtons(e){e?(this.eMoveUpButton.appendChild((0,import_core19._createIconNoSpan)("advancedFilterBuilderMoveUp",this.gos)),this.addManagedListeners(this.eMoveUpButton,{click:()=>this.moveItem(!0),keydown:t=>{switch(t.key){case import_core19.KeyCode.ENTER:t.preventDefault(),(0,import_core19._stopPropagationForAgGrid)(t),this.moveItem(!0);break}}}),this.moveUpTooltipFeature=this.createManagedBean(new import_core19.TooltipFeature({getGui:()=>this.eMoveUpButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.moveUpDisabled?null:this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveUpButtonTooltip")})),(0,import_core19._setAriaLabel)(this.eMoveUpButton,this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveUpButtonTooltip")),this.eMoveDownButton.appendChild((0,import_core19._createIconNoSpan)("advancedFilterBuilderMoveDown",this.gos)),this.addManagedListeners(this.eMoveDownButton,{click:()=>this.moveItem(!1),keydown:t=>{switch(t.key){case import_core19.KeyCode.ENTER:t.preventDefault(),(0,import_core19._stopPropagationForAgGrid)(t),this.moveItem(!1);break}}}),this.moveDownTooltipFeature=this.createManagedBean(new import_core19.TooltipFeature({getGui:()=>this.eMoveDownButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.moveDownDisabled?null:this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveDownButtonTooltip")})),(0,import_core19._setAriaLabel)(this.eMoveDownButton,this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveDownButtonTooltip")),this.activateTabIndex([this.eMoveUpButton,this.eMoveDownButton])):((0,import_core19._setDisplayed)(this.eMoveUpButton,!1),(0,import_core19._setDisplayed)(this.eMoveDownButton,!1))}updateValidity(){(0,import_core19._setVisible)(this.eValidation,!this.item.valid),this.validationTooltipFeature.refreshToolTip(),this.updateAriaLabel()}createPill(e){const{key:t,displayValue:i,cssClass:s,update:a,ariaLabel:r}=e,n=o=>{o!=null&&(a(o),this.dispatchLocalEvent({type:"advancedFilterBuilderValueChanged"}))};if(e.isSelect){const{getEditorParams:o,pickerAriaLabelKey:l,pickerAriaLabelValue:u}=e,d=this.gos.get("advancedFilterBuilderParams"),c=`${d?.pillSelectMinWidth??140}px`,v=`${d?.pillSelectMaxWidth??200}px`,p=this.createBean(new SelectPillComp({pickerAriaLabelKey:l,pickerAriaLabelValue:u,pickerType:"ag-list",value:{key:t,displayValue:i},valueFormatter:h=>h==null?null:h.displayValue??h.key,variableWidth:!0,minPickerWidth:c,maxPickerWidth:v,getEditorParams:o,wrapperClassName:s,ariaLabel:r}));return this.addManagedListeners(p,{fieldPickerValueSelected:({value:h})=>n(h?.key)}),p}else{const o=this.createBean(new InputPillComp({value:i,cssClass:s,type:this.getInputType(e.baseCellDataType),ariaLabel:r}));return this.addManagedListeners(o,{fieldValueChanged:({value:l})=>n(l)}),o}}getInputType(e){switch(e){case"text":case"object":case"boolean":return"text";case"number":return"number";case"date":case"dateString":return"date"}}setupDragging(){const e={type:import_core19.DragSourceType.AdvancedFilterBuilder,eElement:this.eDragHandle,dragItemName:()=>this.ePillWrapper.getDragName(),getDefaultIconName:()=>"notAllowed",getDragItem:()=>({}),onDragStarted:()=>this.dragFeature.dispatchLocalEvent({type:"advancedFilterBuilderDragStarted",item:this.item}),onDragStopped:()=>this.dragFeature.dispatchLocalEvent({type:"advancedFilterBuilderDragEnded"})};this.dragAndDropService.addDragSource(e,!0),this.addDestroyFunc(()=>this.dragAndDropService.removeDragSource(e))}updateAriaLabel(){const e=this.ePillWrapper.getAriaLabel(),t=`${this.item.level+1}`,i=this.ePillWrapper.getValidationMessage();let s;i?s=this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderItemValidation",[e,t,i]):s=this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderItem",[e,t]),(0,import_core19._setAriaLabel)(this.focusWrapper,s)}updateAriaExpanded(){(0,import_core19._removeAriaExpanded)(this.focusWrapper);const{filterModel:e}=this.item;e?.filterType==="join"&&e.conditions.length&&(0,import_core19._setAriaExpanded)(this.focusWrapper,!0)}removeItem(){this.dispatchLocalEvent({type:"advancedFilterBuilderRemoved",item:this.item})}moveItem(e){this.dispatchLocalEvent({type:"advancedFilterBuilderMoved",item:this.item,backwards:e})}},AdvancedFilterBuilderComp=class extends import_core20.Component{constructor(){super(`
            <div role="presentation" class="ag-advanced-filter-builder" tabindex="-1">
                <div role="presentation" class="ag-advanced-filter-builder-list" data-ref="eList"></div>
                <div role="presentation" class="ag-advanced-filter-builder-button-panel">
                    <button class="ag-button ag-standard-button ag-advanced-filter-builder-apply-button" data-ref="eApplyFilterButton"></button>
                    <button class="ag-button ag-standard-button ag-advanced-filter-builder-cancel-button" data-ref="eCancelFilterButton"></button>
                </div>
            </div>`),this.eList=import_core20.RefPlaceholder,this.eApplyFilterButton=import_core20.RefPlaceholder,this.eCancelFilterButton=import_core20.RefPlaceholder,this.validationMessage=null}wireBeans(e){this.filterManager=e.filterManager,this.advancedFilterService=e.advancedFilterService,this.advancedFilterExpressionService=e.advancedFilterExpressionService}postConstruct(){const{showMoveButtons:e}=this.gos.get("advancedFilterBuilderParams")??{};this.showMove=!!e,this.addManagedPropertyListener("advancedFilterBuilderParams",({currentValue:t})=>{this.showMove=!!t?.showMoveButtons,this.refreshList(!1)}),this.filterModel=this.setupFilterModel(),this.setupVirtualList(),this.dragFeature=this.createManagedBean(new AdvancedFilterBuilderDragFeature(this,this.virtualList)),this.setupButtons()}refresh(){let e=this.virtualList.getLastFocusedRow();this.setupFilterModel(),this.validateItems(),this.refreshList(!1),e!=null&&(this.virtualList.getComponentAt(e)||(e=0),this.virtualList.focusRow(e))}getNumItems(){return this.items.length}moveItem(e,t){!t||!e||this.moveItemToIndex(e,t.rowIndex,t.position)}afterGuiAttached(){this.virtualList.focusRow(0)}setupVirtualList(){this.virtualList=this.createManagedBean(new import_core21.VirtualList({cssIdentifier:"advanced-filter-builder",ariaRole:"tree",listName:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderList")})),this.virtualList.setComponentCreator(this.createItemComponent.bind(this)),this.virtualList.setComponentUpdater(this.updateItemComponent.bind(this)),this.virtualList.setRowHeight(40),this.eList.appendChild(this.virtualList.getGui()),this.virtualList.setModel({getRowCount:()=>this.items.length,getRow:e=>this.items[e],areRowsEqual:(e,t)=>e===t}),this.buildList(),this.virtualList.refresh()}setupButtons(){this.eApplyFilterButton.innerText=this.advancedFilterExpressionService.translate("advancedFilterBuilderApply"),this.activateTabIndex([this.eApplyFilterButton]),this.addManagedElementListeners(this.eApplyFilterButton,{click:()=>{this.advancedFilterService.setModel(this.filterModel),this.filterManager?.onFilterChanged({source:"advancedFilter"}),this.close()}}),this.validationTooltipFeature=this.createManagedBean(new import_core20.TooltipFeature({getGui:()=>this.eApplyFilterButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.validationMessage,getTooltipShowDelayOverride:()=>1e3})),this.validate();const e=t=>this.addOrRemoveCssClass("ag-advanced-filter-builder-validation",t);this.addManagedListeners(this.eApplyFilterButton,{mouseenter:()=>e(!0),mouseleave:()=>e(!1)}),this.eCancelFilterButton.innerText=this.advancedFilterExpressionService.translate("advancedFilterBuilderCancel"),this.activateTabIndex([this.eCancelFilterButton]),this.addManagedElementListeners(this.eCancelFilterButton,{click:()=>this.close()})}removeItemFromParent(e){const t=e.parent.conditions.indexOf(e.filterModel);return e.parent.conditions.splice(t,1),t}moveItemToIndex(e,t,i){const s=this.items[t],a=s.filterModel?.filterType==="join"&&i==="bottom",r=a?s.filterModel:s.parent;if(!r||this.isChildOrSelf(r,e.filterModel)||s===e)return;this.removeItemFromParent(e);let n;a?n=0:(n=r.conditions.indexOf(s.filterModel),n===-1?n=r.conditions.length:i==="bottom"&&(n+=1)),r.conditions.splice(n,0,e.filterModel),this.refreshList(!1)}isChildOrSelf(e,t){return e===t||t.filterType==="join"&&t.conditions.some(i=>this.isChildOrSelf(e,i))}setupFilterModel(){const e=this.formatFilterModel(this.advancedFilterService.getModel());return this.stringifiedModel=JSON.stringify(e),e}formatFilterModel(e){return e=e??{filterType:"join",type:"AND",conditions:[]},e.filterType!=="join"&&(e={filterType:"join",type:"AND",conditions:[e]}),e}buildList(){const e=(t,i,s,a)=>{i.push({filterModel:t,level:s,parent:a,valid:!0,showMove:this.showMove}),t.filterType==="join"&&(t.conditions.forEach(r=>e(r,i,s+1,t)),s===0&&i.push({filterModel:null,level:s+1,parent:t,valid:!0}))};this.items=[],e(this.filterModel,this.items,0)}refreshList(e){if(!e){const t=[];this.items.forEach(i=>{i.valid||t.push(i.filterModel)}),this.buildList(),t.length&&this.items.forEach(i=>{i.filterModel&&t.includes(i.filterModel)&&(i.valid=!1)})}this.virtualList.refresh(e),this.validate()}updateItemComponent(e,t){const i=this.items.indexOf(e),s=(o,l)=>{const d=this.items.find(c=>c.filterModel===o)?.parent;if(d){const{conditions:c}=d;s(d,l),l.push(c[c.length-1]===o)}},a=[],{filterModel:r}=e;r&&(s(r,a),a[0]=!1);const n=r?.filterType==="join"&&!!r.conditions.length;t.setState({disableMoveUp:i===1,disableMoveDown:!this.canMoveDown(e,i),treeLines:a,showStartTreeLine:n})}createItemComponent(e,t){const i=this.createBean(e.filterModel?new AdvancedFilterBuilderItemComp(e,this.dragFeature,t):new AdvancedFilterBuilderItemAddComp(e,t));return i.addManagedListeners(i,{advancedFilterBuilderRemoved:({item:s})=>this.removeItem(s),advancedFilterBuilderValueChanged:()=>this.validate(),advancedFilterBuilderAdded:({item:s,isJoin:a})=>this.addItem(s,a),advancedFilterBuilderMoved:({item:s,backwards:a})=>this.moveItemUpDown(s,a)}),i instanceof AdvancedFilterBuilderItemComp&&this.updateItemComponent(e,i),i}addItem(e,t){const{parent:i,level:s,filterModel:a}=e,r=a?.filterType==="join",n=t?{filterType:"join",type:"AND",conditions:[]}:{},o=r?a:i;let l=r?0:o.conditions.indexOf(a);l>=0?(r||(l+=1),o.conditions.splice(l,0,n)):o.conditions.push(n);let u=this.items.indexOf(e);const d=u>=0;if(d){e.filterModel&&u++;const c=[{filterModel:n,level:r?s+1:s,parent:o,valid:t,showMove:this.showMove}];this.items.splice(u,0,...c)}this.refreshList(d),d&&this.virtualList.getComponentAt(u)?.afterAdd()}removeItem(e){const t=e.parent,{filterModel:i}=e,s=t.conditions.indexOf(i);t.conditions.splice(s,1);const a=e.filterModel?.filterType==="join",r=this.items.indexOf(e),n=!a&&r>=0;n&&this.items.splice(r,1),this.refreshList(n),r>=0&&this.virtualList.focusRow(r)}moveItemUpDown(e,t){const i=this.items.indexOf(e),s=t?i-1:i+1;if(s===0||!t&&!this.canMoveDown(e,i))return;const a=this.items[s],r=this.removeItemFromParent(e),{level:n,filterModel:o,parent:l}=e,{level:u,filterModel:d,parent:c}=a;if(t)if(u===n&&d.filterType==="join")d.conditions.push(o);else if(u<=n){const p=c.conditions.indexOf(d);c.conditions.splice(p,0,o)}else l.conditions[r-1].conditions.push(o);else if(u===n)if(d.filterType==="join")d.conditions.splice(0,0,o);else{const p=c.conditions.indexOf(d);c.conditions.splice(p+1,0,o)}else if(r<l.conditions.length)l.conditions.splice(r+1,0,o);else{const p=this.items.find(g=>g.filterModel===l),h=p.parent.conditions.indexOf(p.filterModel)+1;p.parent.conditions.splice(h,0,o)}this.refreshList(!1);const v=this.items.findIndex(({filterModel:p})=>p===o);if(v>=0){const p=this.virtualList.getComponentAt(v);p instanceof AdvancedFilterBuilderItemComp&&p.focusMoveButton(t)}}canMoveDown(e,t){return!(e.level===1&&t===this.items.length-2||e.level===1&&e.parent.conditions[e.parent.conditions.length-1]===e.filterModel)}close(){this.advancedFilterService.getCtrl().toggleFilterBuilder("ui")}validate(){let e=!this.items.every(({valid:t})=>t);e?this.validationMessage=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationIncomplete"):(e=JSON.stringify(this.filterModel)===this.stringifiedModel,e?this.validationMessage=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationAlreadyApplied"):this.validationMessage=null),(0,import_core20._setDisabled)(this.eApplyFilterButton,e),this.validationTooltipFeature.refreshToolTip()}validateItems(){const e=i=>{i.type=void 0},t=i=>{delete i.filter};this.items.forEach(i=>{if(!i.valid||!i.filterModel||i.filterModel.filterType==="join")return;const{filterModel:s}=i,{colId:a}=s,r=this.advancedFilterExpressionService.getColumnAutocompleteEntries().find(({key:u})=>u===a),n=this.advancedFilterExpressionService.getColumnDetails(s.colId);if(!r||!n.column){i.valid=!1,s.colId=void 0,e(s),t(s);return}const l=this.advancedFilterExpressionService.getDataTypeExpressionOperator(n.baseCellDataType).operators[s.type];if(!l){i.valid=!1,e(s),t(s);return}if(l.numOperands>0&&!(0,import_core20._exists)(s.filter)){i.valid=!1;return}})}},AdvancedFilterCtrl=class extends import_core22.BeanStub{constructor(e){super(),this.enabled=e}wireBeans(e){this.ctrlsService=e.ctrlsService,this.popupService=e.popupService,this.advancedFilterExpressionService=e.advancedFilterExpressionService,this.environment=e.environment}postConstruct(){this.hasAdvancedFilterParent=!!this.gos.get("advancedFilterParent"),this.ctrlsService.whenReady(()=>this.setAdvancedFilterComp()),this.addManagedEventListeners({advancedFilterEnabledChanged:({enabled:e})=>this.onEnabledChanged(e)}),this.addManagedPropertyListener("advancedFilterParent",()=>this.updateComps()),this.addDestroyFunc(()=>{this.destroyAdvancedFilterComp(),this.destroyBean(this.eBuilderComp),this.eBuilderDialog&&this.eBuilderDialog.isAlive()&&this.destroyBean(this.eBuilderDialog)})}setupHeaderComp(e){this.eHeaderComp=this.createManagedBean(new AdvancedFilterHeaderComp(this.enabled&&!this.hasAdvancedFilterParent)),e.insertAdjacentElement("beforebegin",this.eHeaderComp.getGui())}focusHeaderComp(){return this.eHeaderComp?(this.eHeaderComp.getFocusableElement().focus(),!0):!1}refreshComp(){this.eFilterComp?.refresh(),this.eHeaderComp?.refresh()}refreshBuilderComp(){this.eBuilderComp?.refresh()}getHeaderHeight(){return this.eHeaderComp?.getHeight()??0}setInputDisabled(e){this.eFilterComp?.setInputDisabled(e),this.eHeaderComp?.setInputDisabled(e)}toggleFilterBuilder(e,t){if(t&&this.eBuilderDialog||t===!1&&!this.eBuilderDialog)return;if(this.eBuilderDialog){this.builderDestroySource=e,this.destroyBean(this.eBuilderDialog);return}this.setInputDisabled(!0);const{width:i,height:s,minWidth:a}=this.getBuilderDialogSize();this.eBuilderComp=this.createBean(new AdvancedFilterBuilderComp),this.eBuilderDialog=this.createBean(new import_core23.AgDialog({title:this.advancedFilterExpressionService.translate("advancedFilterBuilderTitle"),component:this.eBuilderComp,width:i,height:s,resizable:!0,movable:!0,maximizable:!0,centered:!0,closable:!0,minWidth:a,afterGuiAttached:()=>this.eBuilderComp?.afterGuiAttached()})),this.dispatchFilterBuilderVisibleChangedEvent(e,!0),this.eBuilderDialog.addEventListener("destroyed",()=>{this.destroyBean(this.eBuilderComp),this.eBuilderComp=void 0,this.eBuilderDialog=void 0,this.setInputDisabled(!1),this.dispatchLocalEvent({type:"advancedFilterBuilderClosed"}),this.dispatchFilterBuilderVisibleChangedEvent(this.builderDestroySource??"ui",!1),this.builderDestroySource=void 0})}dispatchFilterBuilderVisibleChangedEvent(e,t){const i={type:"advancedFilterBuilderVisibleChanged",source:e,visible:t};this.eventService.dispatchEvent(i)}getBuilderDialogSize(){const e=this.gos.get("advancedFilterBuilderParams")?.minWidth??500,t=this.popupService.getPopupParent(),i=Math.round((0,import_core22._getAbsoluteWidth)(t))-2,s=Math.round((0,import_core22._getAbsoluteHeight)(t)*.75)-2,a=Math.min(Math.max(600,e),i),r=Math.min(600,s);return{width:a,height:r,minWidth:e}}onEnabledChanged(e){this.enabled=e,this.updateComps()}updateComps(){this.setAdvancedFilterComp(),this.setHeaderCompEnabled(),this.eventService.dispatchEvent({type:"headerHeightChanged"})}setAdvancedFilterComp(){if(this.destroyAdvancedFilterComp(),!this.enabled)return;const e=this.gos.get("advancedFilterParent");if(this.hasAdvancedFilterParent=!!e,e){const t=this.createBean(new AdvancedFilterComp),i=t.getGui();this.environment.applyThemeClasses(i),i.classList.add(this.gos.get("enableRtl")?"ag-rtl":"ag-ltr"),e.appendChild(i),this.eFilterComp=t}}setHeaderCompEnabled(){this.eHeaderComp?.setEnabled(this.enabled&&!this.hasAdvancedFilterParent)}destroyAdvancedFilterComp(){this.eFilterComp&&((0,import_core22._removeFromParent)(this.eFilterComp.getGui()),this.destroyBean(this.eFilterComp))}},OperatorParser2=class{constructor(e){this.params=e,this.operators=[],this.operatorStartPositions=[],this.operatorEndPositions=[],this.activeOperator=0,this.validationError=null}parseExpression(e){this.operators.push(""),this.operatorStartPositions.push(e),this.operatorEndPositions.push(void 0);const{expression:t}=this.params;for(;e<t.length;){const i=t[e];if(i===" "){if(this.parseOperator(e-1))return this.activeOperator++,e-1;this.operators[this.activeOperator]+=i}else this.operators[this.activeOperator]+=i;e++}return this.parseOperator(e-1),e}isValid(){return!this.validationError&&(!this.operators.length||!!this.parsedOperator)}getValidationError(){return this.validationError}getFunction(){return this.parsedOperator==="OR"?"||":"&&"}getModel(){return this.parsedOperator==="OR"?"OR":"AND"}getAutocompleteListParams(e,t){let i;if(t==null)i="";else{const a=this.operators[t],r=this.operatorEndPositions[t];i=getSearchString(a,e,r==null?this.params.expression.length:r+1)}let s=this.params.advancedFilterExpressionService.getJoinOperatorAutocompleteEntries();return(t||t==null&&this.activeOperator)&&(s=s.filter(({key:a})=>a===this.parsedOperator)),this.params.advancedFilterExpressionService.generateAutocompleteListParams(s,"join",i)}updateExpression(e,t,i){let{expression:s}=this.params;const a=t.displayValue??t.key;if(i===0)for(let o=this.operatorEndPositions.length-1;o>0;o--){const l=this.operatorEndPositions[o];l!=null&&(s=updateExpression(s,this.operatorStartPositions[o],l,a).updatedValue)}const r=this.operatorStartPositions.length>i?this.operatorStartPositions[i]:e,n=(this.operatorEndPositions.length>i?this.operatorEndPositions[i]:void 0)??findEndPosition(s,e,!0).endPosition;return updateExpression(s,r,n,a,!0)}getNumOperators(){return this.operators.length}getLastOperatorEndPosition(){return this.operatorEndPositions[this.operatorEndPositions.length-1]}parseOperator(e){const t=this.operators.length>this.activeOperator?this.operators[this.activeOperator]:"",i=this.params.advancedFilterExpressionService.getExpressionJoinOperators(),s=findMatch(t,i,a=>a);if(s){this.operatorEndPositions[this.activeOperator]=e;const a=i[s];if(this.activeOperator){if(s!==this.parsedOperator)return this.validationError||(this.validationError={message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationJoinOperatorMismatch"),startPosition:e-t.length+1,endPosition:e}),!1}else this.parsedOperator=s;return t!==a&&(checkAndUpdateExpression(this.params,t,a,e),this.operators[this.activeOperator]=a),!0}else return s===null?!1:(this.validationError||(this.validationError={message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationInvalidJoinOperator"),startPosition:e-t.length+1,endPosition:e}),!0)}},JoinFilterExpressionParser=class m{constructor(t,i){this.params=t,this.startPosition=i,this.expectingExpression=!0,this.expectingOperator=!1,this.expressionParsers=[],this.operatorParser=new OperatorParser2(this.params),this.missingEndBracket=!1,this.extraEndBracket=!1}parseExpression(){let t=this.startPosition;const{expression:i}=this.params;for(;t<i.length;){const s=i[t];if(s==="("&&!this.expectingOperator){const a=new m(this.params,t+1);t=a.parseExpression(),this.expressionParsers.push(a),this.expectingExpression=!1,this.expectingOperator=!0}else{if(s===")")return this.endPosition=t-1,this.startPosition===0&&(this.extraEndBracket=!0),t;if(s!==" ")if(this.expectingExpression){const a=new ColFilterExpressionParser(this.params,t);t=a.parseExpression(),this.expressionParsers.push(a),this.expectingExpression=!1,this.expectingOperator=!0}else this.expectingOperator&&(t=this.operatorParser.parseExpression(t),this.expectingOperator=!1,this.expectingExpression=!0)}t++}return this.startPosition>0&&(this.missingEndBracket=!0),t}isValid(){return!this.missingEndBracket&&!this.extraEndBracket&&this.expressionParsers.length===this.operatorParser.getNumOperators()+1&&this.operatorParser.isValid()&&this.expressionParsers.every(t=>t.isValid())}getValidationError(){const t=this.operatorParser.getValidationError();for(let s=0;s<this.expressionParsers.length;s++){const a=this.expressionParsers[s].getValidationError();if(a)return t&&t.startPosition<a.startPosition?t:a}if(t)return t;if(this.extraEndBracket)return{message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationExtraEndBracket"),startPosition:this.endPosition+1,endPosition:this.endPosition+1};let i;return this.expressionParsers.length===this.operatorParser.getNumOperators()?i="advancedFilterValidationMissingCondition":this.missingEndBracket&&(i="advancedFilterValidationMissingEndBracket"),i?{message:this.params.advancedFilterExpressionService.translate(i),startPosition:this.params.expression.length,endPosition:this.params.expression.length}:null}getFunctionString(t){const i=this.expressionParsers.length>1,s=this.expressionParsers.map(a=>a.getFunctionString(t)).join(` ${this.operatorParser.getFunction()} `);return i?`(${s})`:s}getFunctionParsed(t){const i=this.operatorParser.getFunction(),s=this.expressionParsers.map(r=>r.getFunctionParsed(t)),a=i==="&&"?"every":"some";return(r,n,o)=>s[a](l=>l(r,n,o))}getAutocompleteListParams(t){if(this.endPosition!=null&&t>this.endPosition+1)return;if(!this.expressionParsers.length)return this.getColumnAutocompleteListParams();const i=this.getExpressionParserIndex(t);if(i==null)return this.params.expression[t]==="("?{enabled:!1}:this.getColumnAutocompleteListParams();const a=this.expressionParsers[i].getAutocompleteListParams(t);if(!a){if(i<this.expressionParsers.length-1)return this.operatorParser.getAutocompleteListParams(t,i);if(this.expressionParsers.length===this.operatorParser.getNumOperators()){const r=this.operatorParser.getLastOperatorEndPosition();return r==null||t<=r+1?this.operatorParser.getAutocompleteListParams(t,this.operatorParser.getNumOperators()-1):this.getColumnAutocompleteListParams()}return this.params.expression[t-1]===")"?{enabled:!1}:this.operatorParser.getAutocompleteListParams(t)}return a}updateExpression(t,i,s){const a=this.params.expression,r=this.getExpressionParserIndex(t);if(r==null){const l=s==="column"?this.params.advancedFilterExpressionService.getColumnValue(i):i.displayValue??i.key;return updateExpression(a,this.startPosition,this.startPosition,l,!0)}const o=this.expressionParsers[r].updateExpression(t,i,s);return o??(s==="column"?updateExpression(a,t,a.length-1,this.params.advancedFilterExpressionService.getColumnValue(i),!0):this.endPosition!=null&&t>this.endPosition+1?null:this.operatorParser.updateExpression(t,i,r))}getModel(){return this.expressionParsers.length>1?{filterType:"join",type:this.operatorParser.getModel(),conditions:this.expressionParsers.map(t=>t.getModel())}:this.expressionParsers[0].getModel()}getColumnAutocompleteListParams(){return this.params.advancedFilterExpressionService.generateAutocompleteListParams(this.params.advancedFilterExpressionService.getColumnAutocompleteEntries(),"column","")}getExpressionParserIndex(t){let i;for(let s=0;s<this.expressionParsers.length&&!(this.expressionParsers[s].startPosition>t);s++)i=s;return i}},FilterExpressionParser=class{constructor(e){this.params=e,this.valid=!1}parseExpression(){this.joinExpressionParser=new JoinFilterExpressionParser(this.params,0);const e=this.joinExpressionParser.parseExpression();return this.valid=e>=this.params.expression.length-1&&this.joinExpressionParser.isValid(),this.params.expression}isValid(){return this.valid}getValidationMessage(){const e=this.joinExpressionParser.getValidationError();if(!e)return null;const{message:t,startPosition:i,endPosition:s}=e;return i<this.params.expression.length?this.params.advancedFilterExpressionService.translate("advancedFilterValidationMessage",[t,this.params.expression.slice(i,s+1).trim()]):this.params.advancedFilterExpressionService.translate("advancedFilterValidationMessageAtEnd",[t])}getFunctionString(){const e=this.createFunctionParams();return{functionString:`return ${this.joinExpressionParser.getFunctionString(e)};`,params:e}}getFunctionParsed(){const e=this.createFunctionParams();return{expressionFunction:this.joinExpressionParser.getFunctionParsed(e),params:e}}getAutocompleteListParams(e){return this.joinExpressionParser.getAutocompleteListParams(e)??{enabled:!1}}updateExpression(e,t,i){return this.joinExpressionParser.updateExpression(e,t,i)}getModel(){return this.isValid()?this.joinExpressionParser.getModel():null}createFunctionParams(){return{operands:[],operators:[],evaluatorParams:[]}}},AdvancedFilterService=class extends import_core24.BeanStub{constructor(){super(...arguments),this.beanName="advancedFilterService",this.appliedExpression=null,this.expression=null,this.isValid=!0}wireBeans(e){this.valueService=e.valueService,this.columnModel=e.columnModel,this.dataTypeService=e.dataTypeService,this.rowModel=e.rowModel,this.advancedFilterExpressionService=e.advancedFilterExpressionService}postConstruct(){this.setEnabled(this.gos.get("enableAdvancedFilter"),!0),this.ctrl=this.createManagedBean(new AdvancedFilterCtrl(this.enabled)),this.expressionProxy={getValue:(e,t)=>{const i=this.columnModel.getColDefCol(e);return i?this.valueService.getValue(i,t,!0):void 0}},this.addManagedPropertyListener("enableAdvancedFilter",e=>this.setEnabled(!!e.currentValue)),this.addManagedEventListeners({newColumnsLoaded:e=>this.onNewColumnsLoaded(e)}),this.addManagedPropertyListener("includeHiddenColumnsInAdvancedFilter",()=>this.updateValidity())}isEnabled(){return this.enabled}isFilterPresent(){return!!this.expressionFunction}doesFilterPass(e){return this.expressionFunction(this.expressionProxy,e,this.expressionParams)}getModel(){const e=this.createExpressionParser(this.appliedExpression);return e?.parseExpression(),e?.getModel()??null}setModel(e){const t=(s,a)=>{if(s.filterType==="join"){const r=this.advancedFilterExpressionService.parseJoinOperator(s),n=s.conditions.map(o=>t(o)).filter(o=>(0,import_core24._exists)(o)).join(` ${r} `);return a||s.conditions.length<=1?n:`(${n})`}else return this.advancedFilterExpressionService.parseColumnFilterModel(s)},i=e?t(e,!0):null;this.setExpressionDisplayValue(i),this.applyExpression(),this.ctrl.refreshComp(),this.ctrl.refreshBuilderComp()}getExpressionDisplayValue(){return this.expression}setExpressionDisplayValue(e){this.expression=e}isCurrentExpressionApplied(){return this.appliedExpression===this.expression}createExpressionParser(e){return e?new FilterExpressionParser({expression:e,columnModel:this.columnModel,dataTypeService:this.dataTypeService,valueService:this.valueService,advancedFilterExpressionService:this.advancedFilterExpressionService}):null}getDefaultExpression(e){const t=this.advancedFilterExpressionService.getColumnValue(e)+" ";return{updatedValue:t,updatedPosition:t.length}}isHeaderActive(){return!this.gos.get("advancedFilterParent")}getCtrl(){return this.ctrl}setEnabled(e,t){const i=this.enabled,s=this.rowModel.getType(),a=s==="clientSide"||s==="serverSide";if(e&&!s&&(0,import_core24._warnOnce)("Advanced Filter is only supported with the Client-Side Row Model or Server-Side Row Model."),this.enabled=e&&a,!t&&this.enabled!==i){const r={type:"advancedFilterEnabledChanged",enabled:this.enabled};this.eventService.dispatchEvent(r)}}applyExpression(){const e=this.createExpressionParser(this.expression);e?.parseExpression(),this.applyExpressionFromParser(e)}applyExpressionFromParser(e){if(this.isValid=!e||e.isValid(),!e||!this.isValid){this.expressionFunction=null,this.expressionParams=null,this.appliedExpression=null;return}const{expressionFunction:t,params:i}=this.getFunction(e);this.expressionFunction=t,this.expressionParams=i,this.appliedExpression=this.expression}getFunction(e){if(this.gos.get("suppressAdvancedFilterEval"))return e.getFunctionParsed();{const{functionString:t,params:i}=e.getFunctionString();return{expressionFunction:new Function("expressionProxy","node","params",t),params:i}}}updateValidity(){this.advancedFilterExpressionService.resetColumnCaches();const e=this.createExpressionParser(this.expression);e?.parseExpression();const i=(!e||e.isValid())!==this.isValid;return this.applyExpressionFromParser(e),this.ctrl.refreshComp(),this.ctrl.refreshBuilderComp(),i}onNewColumnsLoaded(e){if(e.source!=="gridInitializing"||!this.dataTypeService?.isPendingInference())return;this.ctrl.setInputDisabled(!0);const[t]=this.addManagedEventListeners({dataTypesInferred:()=>{t?.(),this.ctrl.setInputDisabled(!1)}})}},VERSION="32.0.0",AdvancedFilterCoreModule={version:VERSION,moduleName:`${import_core25.ModuleNames.AdvancedFilterModule}-core`,beans:[AdvancedFilterService,AdvancedFilterExpressionService],dependantModules:[import_core26.EnterpriseCoreModule,import_core25._FilterCoreModule]},AdvancedFilterApiModule={version:VERSION,moduleName:`${import_core25.ModuleNames.AdvancedFilterModule}-api`,apiFunctions:{getAdvancedFilterModel,setAdvancedFilterModel,showAdvancedFilterBuilder,hideAdvancedFilterBuilder},dependantModules:[AdvancedFilterCoreModule]},AdvancedFilterModule={version:VERSION,moduleName:import_core25.ModuleNames.AdvancedFilterModule,dependantModules:[AdvancedFilterCoreModule,AdvancedFilterApiModule]};
