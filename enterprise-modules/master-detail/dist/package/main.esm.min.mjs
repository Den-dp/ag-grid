import{ModuleNames as o}from"@ag-grid-community/core";import{EnterpriseCoreModule as m,GroupCellRenderer as l,GroupCellRendererCtrl as u}from"@ag-grid-enterprise/core";import{Component as f,ModuleRegistry as g,RefPlaceholder as G,_cloneObject as D,_missing as R,_warnOnce as c,createGrid as w}from"@ag-grid-community/core";import{BeanStub as v,_missing as I,_warnOnce as d}from"@ag-grid-community/core";var h=class extends v{constructor(){super(...arguments),this.loadRowDataVersion=0}wireBeans(e){this.focusService=e.focusService,this.rowPositionUtils=e.rowPositionUtils,this.environment=e.environment}init(e,t){this.params=t,this.comp=e,t.pinned==null&&(this.setAutoHeightClasses(),this.setupRefreshStrategy(),this.addThemeToDetailGrid(),this.createDetailGrid(),this.loadRowData(),this.addManagedEventListeners({fullWidthRowFocused:this.onFullWidthRowFocused.bind(this)}))}onFullWidthRowFocused(e){const t=this.params,i={rowIndex:t.node.rowIndex,rowPinned:t.node.rowPinned},s={rowIndex:e.rowIndex,rowPinned:e.rowPinned};this.rowPositionUtils.sameRow(i,s)&&this.focusService.focusInto(this.comp.getGui(),e.fromBelow)}setAutoHeightClasses(){const e=this.gos.get("detailRowAutoHeight"),t=e?"ag-details-row-auto-height":"ag-details-row-fixed-height",i=e?"ag-details-grid-auto-height":"ag-details-grid-fixed-height";this.comp.addOrRemoveCssClass(t,!0),this.comp.addOrRemoveDetailGridCssClass(i,!0)}setupRefreshStrategy(){const e=this.params.refreshStrategy;if(e=="everything"||e=="nothing"||e=="rows"){this.refreshStrategy=e;return}e!=null&&d("invalid cellRendererParams.refreshStrategy = '"+e+"' supplied, defaulting to refreshStrategy = 'rows'."),this.refreshStrategy="rows"}addThemeToDetailGrid(){for(const e of this.environment.getThemeClasses())this.comp.addOrRemoveDetailGridCssClass(e,!0)}createDetailGrid(){if(I(this.params.detailGridOptions)){d("could not find detail grid options for master detail, please set gridOptions.detailCellRendererParams.detailGridOptions");return}const e=this.gos.get("detailRowAutoHeight"),t={...this.params.detailGridOptions};e&&(t.domLayout="autoHeight"),this.comp.setDetailGrid(t)}registerDetailWithMaster(e){const t=this.params.node.id,i=this.params.api,s={id:t,api:e},a=this.params.node;i.isDestroyed()||(i.addDetailGridInfo(t,s),a.detailGridInfo=s,this.addDestroyFunc(()=>{a.detailGridInfo===s&&(i.isDestroyed()||i.removeDetailGridInfo(t),a.detailGridInfo=null)}))}loadRowData(){this.loadRowDataVersion++;const e=this.loadRowDataVersion;if(this.params.detailGridOptions?.rowModelType==="serverSide"){this.params.node.detailGridInfo?.api?.refreshServerSide({purge:!0});return}const t=this.params.getDetailRowData;if(!t){d("could not find getDetailRowData for master / detail, please set gridOptions.detailCellRendererParams.getDetailRowData");return}const i=a=>{this.loadRowDataVersion===e&&this.comp.setRowData(a)},s={node:this.params.node,data:this.params.node.data,successCallback:i,context:this.gos.getGridCommonParams().context};t(s)}refresh(){switch(this.refreshStrategy){case"nothing":return!0;case"everything":return!1}return this.loadRowData(),!0}},C=class extends f{constructor(){super(...arguments),this.eDetailGrid=G}wireBeans(e){this.context=e.context}init(e){this.params=e,this.selectAndSetTemplate();const t={addOrRemoveCssClass:(i,s)=>this.addOrRemoveCssClass(i,s),addOrRemoveDetailGridCssClass:(i,s)=>this.eDetailGrid.classList.toggle(i,s),setDetailGrid:i=>this.setDetailGrid(i),setRowData:i=>this.setRowData(i),getGui:()=>this.eDetailGrid};this.ctrl=this.createManagedBean(new h),this.ctrl.init(t,e)}refresh(){return this.ctrl&&this.ctrl.refresh()}destroy(){super.destroy()}selectAndSetTemplate(){if(this.params.pinned){this.setTemplate('<div class="ag-details-row"></div>');return}const e=()=>{this.setTemplate(`<div class="ag-details-row" role="gridcell">
                <div data-ref="eDetailGrid" class="ag-details-grid" role="presentation"></div>
            </div>`)};if(R(this.params.template))e();else if(typeof this.params.template=="string")this.setTemplate(this.params.template,[]);else if(typeof this.params.template=="function"){const t=this.params.template,i=t(this.params);this.setTemplate(i,[])}else c("detailCellRendererParams.template should be function or string"),e();this.eDetailGrid==null&&c('Reference to eDetailGrid was missing from the details template. Please add data-ref="eDetailGrid" to the template.')}setDetailGrid(e){if(!this.eDetailGrid)return;const t=this.context.getBean("agGridReact"),i=t?D(t):void 0,s=this.context.getBean("frameworkComponentWrapper"),a=this.getFrameworkOverrides(),r=w(this.eDetailGrid,e,{frameworkOverrides:a,providedBeanInstances:{agGridReact:i,frameworkComponentWrapper:s},modules:g.__getGridRegisteredModules(this.params.api.getGridId())});this.detailApi=r,this.ctrl.registerDetailWithMaster(r),this.addDestroyFunc(()=>{r?.destroy()})}setRowData(e){this.detailApi&&this.detailApi.setGridOption("rowData",e)}};import{BeanStub as S,_exists as O,_iterateObject as M}from"@ag-grid-community/core";var _=class extends S{constructor(){super(...arguments),this.beanName="detailGridApiService",this.detailGridInfoMap={}}addDetailGridInfo(e,t){this.detailGridInfoMap[e]=t}removeDetailGridInfo(e){delete this.detailGridInfoMap[e]}getDetailGridInfo(e){return this.detailGridInfoMap[e]}forEachDetailGridInfo(e){let t=0;M(this.detailGridInfoMap,(i,s)=>{O(s)&&(e(s,t),t++)})}destroy(){this.detailGridInfoMap={},super.destroy()}};function T(e,t,i){e.detailGridApiService?.addDetailGridInfo(t,i)}function y(e,t){e.detailGridApiService?.removeDetailGridInfo(t)}function x(e,t){return e.detailGridApiService?.getDetailGridInfo(t)}function P(e,t){e.detailGridApiService?.forEachDetailGridInfo(t)}var n="32.0.0",p={version:n,moduleName:`${o.MasterDetailModule}-core`,userComponents:[{name:"agGroupRowRenderer",classImp:l},{name:"agGroupCellRenderer",classImp:l},{name:"agDetailCellRenderer",classImp:C}],controllers:[{name:"detailCellRenderer",classImp:h},{name:"groupCellRendererCtrl",classImp:u}],dependantModules:[m]},A={version:n,moduleName:`${o.MasterDetailModule}-api`,beans:[_],apiFunctions:{addDetailGridInfo:T,removeDetailGridInfo:y,getDetailGridInfo:x,forEachDetailGridInfo:P},dependantModules:[p]},E={version:n,moduleName:o.MasterDetailModule,dependantModules:[p,A]};export{E as MasterDetailModule};
