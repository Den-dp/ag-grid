var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__export=(e,t)=>{for(var i in t)__defProp(e,i,{get:t[i],enumerable:!0})},__copyProps=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of __getOwnPropNames(t))!__hasOwnProp.call(e,a)&&a!==i&&__defProp(e,a,{get:()=>t[a],enumerable:!(r=__getOwnPropDesc(t,a))||r.enumerable});return e},__toCommonJS=e=>__copyProps(__defProp({},"__esModule",{value:!0}),e),main_exports={};__export(main_exports,{MasterDetailModule:()=>MasterDetailModule}),module.exports=__toCommonJS(main_exports);var import_core4=require("@ag-grid-community/core"),import_core5=require("@ag-grid-enterprise/core"),import_core2=require("@ag-grid-community/core"),import_core=require("@ag-grid-community/core"),DetailCellRendererCtrl=class extends import_core.BeanStub{constructor(){super(...arguments),this.loadRowDataVersion=0}wireBeans(e){this.focusService=e.focusService,this.rowPositionUtils=e.rowPositionUtils,this.environment=e.environment}init(e,t){this.params=t,this.comp=e,t.pinned==null&&(this.setAutoHeightClasses(),this.setupRefreshStrategy(),this.addThemeToDetailGrid(),this.createDetailGrid(),this.loadRowData(),this.addManagedEventListeners({fullWidthRowFocused:this.onFullWidthRowFocused.bind(this)}))}onFullWidthRowFocused(e){const t=this.params,i={rowIndex:t.node.rowIndex,rowPinned:t.node.rowPinned},r={rowIndex:e.rowIndex,rowPinned:e.rowPinned};this.rowPositionUtils.sameRow(i,r)&&this.focusService.focusInto(this.comp.getGui(),e.fromBelow)}setAutoHeightClasses(){const e=this.gos.get("detailRowAutoHeight"),t=e?"ag-details-row-auto-height":"ag-details-row-fixed-height",i=e?"ag-details-grid-auto-height":"ag-details-grid-fixed-height";this.comp.addOrRemoveCssClass(t,!0),this.comp.addOrRemoveDetailGridCssClass(i,!0)}setupRefreshStrategy(){const e=this.params.refreshStrategy;if(e=="everything"||e=="nothing"||e=="rows"){this.refreshStrategy=e;return}e!=null&&(0,import_core._warnOnce)("invalid cellRendererParams.refreshStrategy = '"+e+"' supplied, defaulting to refreshStrategy = 'rows'."),this.refreshStrategy="rows"}addThemeToDetailGrid(){for(const e of this.environment.getThemeClasses())this.comp.addOrRemoveDetailGridCssClass(e,!0)}createDetailGrid(){if((0,import_core._missing)(this.params.detailGridOptions)){(0,import_core._warnOnce)("could not find detail grid options for master detail, please set gridOptions.detailCellRendererParams.detailGridOptions");return}const e=this.gos.get("detailRowAutoHeight"),t={...this.params.detailGridOptions};e&&(t.domLayout="autoHeight"),this.comp.setDetailGrid(t)}registerDetailWithMaster(e){const t=this.params.node.id,i=this.params.api,r={id:t,api:e},a=this.params.node;i.isDestroyed()||(i.addDetailGridInfo(t,r),a.detailGridInfo=r,this.addDestroyFunc(()=>{a.detailGridInfo===r&&(i.isDestroyed()||i.removeDetailGridInfo(t),a.detailGridInfo=null)}))}loadRowData(){this.loadRowDataVersion++;const e=this.loadRowDataVersion;if(this.params.detailGridOptions?.rowModelType==="serverSide"){this.params.node.detailGridInfo?.api?.refreshServerSide({purge:!0});return}const t=this.params.getDetailRowData;if(!t){(0,import_core._warnOnce)("could not find getDetailRowData for master / detail, please set gridOptions.detailCellRendererParams.getDetailRowData");return}const i=a=>{this.loadRowDataVersion===e&&this.comp.setRowData(a)},r={node:this.params.node,data:this.params.node.data,successCallback:i,context:this.gos.getGridCommonParams().context};t(r)}refresh(){switch(this.refreshStrategy){case"nothing":return!0;case"everything":return!1}return this.loadRowData(),!0}},DetailCellRenderer=class extends import_core2.Component{constructor(){super(...arguments),this.eDetailGrid=import_core2.RefPlaceholder}wireBeans(e){this.context=e.context}init(e){this.params=e,this.selectAndSetTemplate();const t={addOrRemoveCssClass:(i,r)=>this.addOrRemoveCssClass(i,r),addOrRemoveDetailGridCssClass:(i,r)=>this.eDetailGrid.classList.toggle(i,r),setDetailGrid:i=>this.setDetailGrid(i),setRowData:i=>this.setRowData(i),getGui:()=>this.eDetailGrid};this.ctrl=this.createManagedBean(new DetailCellRendererCtrl),this.ctrl.init(t,e)}refresh(){return this.ctrl&&this.ctrl.refresh()}destroy(){super.destroy()}selectAndSetTemplate(){if(this.params.pinned){this.setTemplate('<div class="ag-details-row"></div>');return}const e=()=>{this.setTemplate(`<div class="ag-details-row" role="gridcell">
                <div data-ref="eDetailGrid" class="ag-details-grid" role="presentation"></div>
            </div>`)};if((0,import_core2._missing)(this.params.template))e();else if(typeof this.params.template=="string")this.setTemplate(this.params.template,[]);else if(typeof this.params.template=="function"){const t=this.params.template,i=t(this.params);this.setTemplate(i,[])}else(0,import_core2._warnOnce)("detailCellRendererParams.template should be function or string"),e();this.eDetailGrid==null&&(0,import_core2._warnOnce)('Reference to eDetailGrid was missing from the details template. Please add data-ref="eDetailGrid" to the template.')}setDetailGrid(e){if(!this.eDetailGrid)return;const t=this.context.getBean("agGridReact"),i=t?(0,import_core2._cloneObject)(t):void 0,r=this.context.getBean("frameworkComponentWrapper"),a=this.getFrameworkOverrides(),s=(0,import_core2.createGrid)(this.eDetailGrid,e,{frameworkOverrides:a,providedBeanInstances:{agGridReact:i,frameworkComponentWrapper:r},modules:import_core2.ModuleRegistry.__getGridRegisteredModules(this.params.api.getGridId())});this.detailApi=s,this.ctrl.registerDetailWithMaster(s),this.addDestroyFunc(()=>{s?.destroy()})}setRowData(e){this.detailApi&&this.detailApi.setGridOption("rowData",e)}},import_core3=require("@ag-grid-community/core"),DetailGridApiService=class extends import_core3.BeanStub{constructor(){super(...arguments),this.beanName="detailGridApiService",this.detailGridInfoMap={}}addDetailGridInfo(e,t){this.detailGridInfoMap[e]=t}removeDetailGridInfo(e){delete this.detailGridInfoMap[e]}getDetailGridInfo(e){return this.detailGridInfoMap[e]}forEachDetailGridInfo(e){let t=0;(0,import_core3._iterateObject)(this.detailGridInfoMap,(i,r)=>{(0,import_core3._exists)(r)&&(e(r,t),t++)})}destroy(){this.detailGridInfoMap={},super.destroy()}};function addDetailGridInfo(e,t,i){e.detailGridApiService?.addDetailGridInfo(t,i)}function removeDetailGridInfo(e,t){e.detailGridApiService?.removeDetailGridInfo(t)}function getDetailGridInfo(e,t){return e.detailGridApiService?.getDetailGridInfo(t)}function forEachDetailGridInfo(e,t){e.detailGridApiService?.forEachDetailGridInfo(t)}var VERSION="32.0.0",MasterDetailCoreModule={version:VERSION,moduleName:`${import_core4.ModuleNames.MasterDetailModule}-core`,userComponents:[{name:"agGroupRowRenderer",classImp:import_core5.GroupCellRenderer},{name:"agGroupCellRenderer",classImp:import_core5.GroupCellRenderer},{name:"agDetailCellRenderer",classImp:DetailCellRenderer}],controllers:[{name:"detailCellRenderer",classImp:DetailCellRendererCtrl},{name:"groupCellRendererCtrl",classImp:import_core5.GroupCellRendererCtrl}],dependantModules:[import_core5.EnterpriseCoreModule]},MasterDetailApiModule={version:VERSION,moduleName:`${import_core4.ModuleNames.MasterDetailModule}-api`,beans:[DetailGridApiService],apiFunctions:{addDetailGridInfo,removeDetailGridInfo,getDetailGridInfo,forEachDetailGridInfo},dependantModules:[MasterDetailCoreModule]},MasterDetailModule={version:VERSION,moduleName:import_core4.ModuleNames.MasterDetailModule,dependantModules:[MasterDetailCoreModule,MasterDetailApiModule]};
