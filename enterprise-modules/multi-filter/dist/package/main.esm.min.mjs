var A=Object.defineProperty,T=Object.defineProperties,R=Object.getOwnPropertyDescriptor,N=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,E=(n,t,e)=>t in n?A(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,v=(n,t)=>{for(var e in t||(t={}))S.call(t,e)&&E(n,e,t[e]);if(D)for(var e of D(t))U.call(t,e)&&E(n,e,t[e]);return n},M=(n,t)=>T(n,N(t)),f=(n,t,e,i)=>{for(var s=i>1?void 0:i?R(t,e):t,r=n.length-1,l;r>=0;r--)(l=n[r])&&(s=(i?l(t,e,s):l(s))||s);return i&&s&&A(t,e,s),s};import{ModuleNames as B}from"@ag-grid-community/core";import{EnterpriseCoreModule as j}from"@ag-grid-enterprise/core";import{ProvidedFilter as G,AgPromise as c,Autowired as _,AgGroupComponent as w,TabGuardComp as V,AgMenuItemComponent as O,AgMenuItemRenderer as k,PostConstruct as W,_ as g,KeyCode as d}from"@ag-grid-community/core";var m=class b extends V{constructor(){super('<div class="ag-multi-filter ag-menu-list-compact"></div>'),this.filterDefs=[],this.filters=[],this.guiDestroyFuncs=[],this.filterGuis=[],this.activeFilterIndices=[],this.lastActivatedMenuItem=null,this.afterFiltersReadyFuncs=[]}postConstruct(){this.initialiseTabGuard({onFocusIn:t=>this.onFocusIn(t)})}static getFilterDefs(t){const{filters:e}=t;return e&&e.length>0?e:[{filter:"agTextColumnFilter"},{filter:"agSetColumnFilter"}]}init(t){this.params=t,this.filterDefs=b.getFilterDefs(t);const{column:e,filterChangedCallback:i}=t;this.column=e,this.filterChangedCallback=i;const s=[];return this.filterDefs.forEach((r,l)=>{const a=this.createFilter(r,l);a!=null&&s.push(a)}),new c(r=>{c.all(s).then(l=>{this.filters=l,this.refreshGui("columnMenu").then(()=>{r()})})}).then(()=>{this.afterFiltersReadyFuncs.forEach(r=>r()),this.afterFiltersReadyFuncs.length=0})}refreshGui(t){return t===this.lastOpenedInContainer?c.resolve():(this.removeAllChildrenExceptTabGuards(),this.destroyChildren(),c.all(this.filters.map((e,i)=>{const s=this.filterDefs[i],r=this.getFilterTitle(e,s);let l;if(s.display==="subMenu"&&t!=="toolPanel")l=this.insertFilterMenu(e,r).then(a=>a.getGui());else if(s.display==="subMenu"||s.display==="accordion"){const a=this.insertFilterGroup(e,r);l=c.resolve(a.getGui())}else l=c.resolve(e.getGui());return l})).then(e=>{e.forEach((i,s)=>{s>0&&this.appendChild(g.loadTemplate('<div class="ag-filter-separator"></div>')),this.appendChild(i)}),this.filterGuis=e,this.lastOpenedInContainer=t}))}getFilterTitle(t,e){return e.title!=null?e.title:t instanceof G?t.getFilterTitle():"Filter"}destroyChildren(){this.guiDestroyFuncs.forEach(t=>t()),this.guiDestroyFuncs.length=0,this.filterGuis.length=0}insertFilterMenu(t,e){const i=this.createBean(new O);return i.init({menuItemDef:{name:e,subMenu:[],cssClasses:["ag-multi-filter-menu-item"],menuItem:k,menuItemParams:{cssClassPrefix:"ag-compact-menu-option",isCompact:!0}},level:0,isAnotherSubMenuOpen:()=>!1,childComponent:t,contextParams:{column:null,node:null,value:null}}).then(()=>{i.setParentComponent(this),this.guiDestroyFuncs.push(()=>this.destroyBean(i)),this.addManagedListener(i,O.EVENT_MENU_ITEM_ACTIVATED,r=>{this.lastActivatedMenuItem&&this.lastActivatedMenuItem!==r.menuItem&&this.lastActivatedMenuItem.deactivate(),this.lastActivatedMenuItem=r.menuItem});const s=i.getGui();return i.addManagedListener(s,"keydown",r=>{const{key:l}=r;switch(l){case d.UP:case d.RIGHT:case d.DOWN:case d.LEFT:r.preventDefault(),l===d.RIGHT&&i.openSubMenu(!0);break}}),i.addManagedListener(s,"focusin",()=>i.activate()),i.addManagedListener(s,"focusout",()=>{!i.isSubMenuOpen()&&!i.isSubMenuOpening()&&i.deactivate()}),i})}insertFilterGroup(t,e){const i=this.createBean(new w({title:e,cssIdentifier:"multi-filter"}));return this.guiDestroyFuncs.push(()=>this.destroyBean(i)),i.addItem(t.getGui()),i.toggleGroupExpand(!1),t.afterGuiAttached&&i.addManagedListener(i,w.EVENT_EXPANDED,()=>t.afterGuiAttached({container:this.lastOpenedInContainer,suppressFocus:!0,hidePopup:this.hidePopup})),i}isFilterActive(){return this.filters.some(t=>t.isFilterActive())}getLastActiveFilterIndex(){return this.activeFilterIndices.length>0?this.activeFilterIndices[this.activeFilterIndices.length-1]:null}doesFilterPass(t,e){let i=!0;return this.filters.forEach(s=>{!i||s===e||!s.isFilterActive()||(i=s.doesFilterPass(t))}),i}getFilterType(){return"multi"}getModelFromUi(){return{filterType:this.getFilterType(),filterModels:this.filters.map(e=>{const i=e;return typeof i.getModelFromUi=="function"?i.getModelFromUi():null})}}getModel(){return this.isFilterActive()?{filterType:this.getFilterType(),filterModels:this.filters.map(e=>e.isFilterActive()?e.getModel():null)}:null}setModel(t){const e=(s,r)=>new c(l=>{const a=s.setModel(r);a?a.then(()=>l()):l()});let i=[];return t==null?i=this.filters.map((s,r)=>e(s,null).then(()=>{this.updateActiveList(r)})):this.filters.forEach((s,r)=>{const l=t.filterModels.length>r?t.filterModels[r]:null,a=e(s,l).then(()=>{this.updateActiveList(r)});i.push(a)}),c.all(i).then(()=>{})}applyModel(t="api"){let e=!1;return this.filters.forEach(i=>{i instanceof G&&(e=i.applyModel(t)||e)}),e}getChildFilterInstance(t){return this.filters[t]}afterGuiAttached(t){let e;t?(this.hidePopup=t.hidePopup,e=this.refreshGui(t.container)):(this.hidePopup=void 0,e=c.resolve()),e.then(()=>{const{filterDefs:i}=this;let s=!1;i&&g.forEachReverse(i,(a,u)=>{var o;const h=u===0,y=!h||a.display!=="inline",x=M(v({},t??{}),{suppressFocus:y}),P=(o=this.filters)==null?void 0:o[u];if(P&&(this.executeFunctionIfExistsOnFilter(P,"afterGuiAttached",x),h&&(s=!0)),h&&y){const I=this.filterGuis[u];I&&(I.focus(),s=!0)}});const r=this.gos.getDocument(),l=this.gos.getActiveDomElement();!s&&(!l||l===r.body||this.getGui().contains(l))&&this.forceFocusOutOfContainer(!0)})}afterGuiDetached(){this.executeFunctionIfExists("afterGuiDetached")}onAnyFilterChanged(){this.executeFunctionIfExists("onAnyFilterChanged")}onNewRowsLoaded(){this.executeFunctionIfExists("onNewRowsLoaded")}destroy(){this.filters.forEach(t=>this.destroyBean(t)),this.filters.length=0,this.destroyChildren(),this.hidePopup=void 0,super.destroy()}executeFunctionIfExists(t,...e){g.forEachReverse(this.filters,i=>{this.executeFunctionIfExistsOnFilter(i,t,e)})}executeFunctionIfExistsOnFilter(t,e,...i){const s=t[e];typeof s=="function"&&s.apply(t,i)}createFilter(t,e){const{filterModifiedCallback:i,doesRowPassOtherFilter:s}=this.params;let r;const l=M(v({},this.filterManager.createFilterParams(this.column,this.column.getColDef())),{filterModifiedCallback:i,filterChangedCallback:o=>{this.executeWhenAllFiltersReady(()=>this.filterChanged(e,o))},doesRowPassOtherFilter:o=>s(o)&&this.doesFilterPass({node:o,data:o.data},r)}),a=this.userComponentFactory.getFilterDetails(t,l,"agTextColumnFilter");if(!a)return null;const u=a.newAgStackInstance();return u&&u.then(o=>r=o),u}executeWhenAllFiltersReady(t){this.filters&&this.filters.length>0?t():this.afterFiltersReadyFuncs.push(t)}updateActiveList(t){const e=this.filters[t];g.removeFromArray(this.activeFilterIndices,t),e.isFilterActive()&&this.activeFilterIndices.push(t)}filterChanged(t,e){this.updateActiveList(t),this.filterChangedCallback(e);const i=this.filters[t];this.filters.forEach(s=>{s!==i&&typeof s.onAnyFilterChanged=="function"&&s.onAnyFilterChanged()})}onFocusIn(t){this.lastActivatedMenuItem!=null&&!this.lastActivatedMenuItem.getGui().contains(t.target)&&(this.lastActivatedMenuItem.deactivate(),this.lastActivatedMenuItem=null)}getModelAsString(t){var e,i,s,r;if(!this.filters||!((e=t?.filterModels)!=null&&e.length))return"";const l=(i=this.getLastActiveFilterIndex())!=null?i:0,a=this.filters[l];return(r=(s=a.getModelAsString)==null?void 0:s.call(a,t.filterModels[l]))!=null?r:""}};f([_("filterManager")],m.prototype,"filterManager",2),f([_("userComponentFactory")],m.prototype,"userComponentFactory",2),f([W],m.prototype,"postConstruct",1);var F=m;import{Component as H,_ as p,Autowired as L,AgPromise as K}from"@ag-grid-community/core";var C=class extends H{constructor(){super('<div class="ag-multi-floating-filter ag-floating-filter-input"></div>'),this.floatingFilters=[],this.compDetailsList=[]}init(n){this.params=n;const{compDetailsList:t}=this.getCompDetailsList(n);return this.setParams(t)}setParams(n){const t=[];return n.forEach(e=>{const i=e?.newAgStackInstance();i!=null&&(this.compDetailsList.push(e),t.push(i))}),K.all(t).then(e=>{e.forEach((i,s)=>{this.floatingFilters.push(i);const r=i.getGui();this.appendChild(r),s>0&&p.setDisplayed(r,!1)})})}onParamsUpdated(n){this.refresh(n)}refresh(n){this.params=n;const{compDetailsList:t,floatingFilterParamsList:e}=this.getCompDetailsList(n);t.length===this.compDetailsList.length&&t.every((s,r)=>!this.filterManager.areFilterCompsDifferent(this.compDetailsList[r],s))?e.forEach((s,r)=>{var l;const a=this.floatingFilters[r];let u=!1;a.refresh&&a.refresh(s)!==null&&(u=!0),u||(l=a.onParamsUpdated)==null||l.call(a,s)}):(p.clearElement(this.getGui()),this.destroyBeans(this.floatingFilters),this.floatingFilters=[],this.compDetailsList=[],this.setParams(t))}getCompDetailsList(n){const t=[],e=[],i=n.filterParams;return F.getFilterDefs(i).forEach((s,r)=>{const l=M(v({},n),{parentFilterInstance:u=>{this.parentMultiFilterInstance(o=>{const h=o.getChildFilterInstance(r);h!=null&&u(h)})}});p.mergeDeep(l.filterParams,s.filterParams);const a=this.getCompDetails(s,l);a&&(t.push(a),e.push(l))}),{compDetailsList:t,floatingFilterParamsList:e}}onParentModelChanged(n,t){t&&t.afterFloatingFilter||this.parentMultiFilterInstance(e=>{if(n==null)this.floatingFilters.forEach((i,s)=>{i.onParentModelChanged(null,t),p.setDisplayed(i.getGui(),s===0)});else{const i=e.getLastActiveFilterIndex();this.floatingFilters.forEach((s,r)=>{const l=n.filterModels.length>r?n.filterModels[r]:null;s.onParentModelChanged(l,t);const a=i==null?r===0:r===i;p.setDisplayed(s.getGui(),a)})}})}destroy(){this.destroyBeans(this.floatingFilters),this.floatingFilters.length=0,super.destroy()}getCompDetails(n,t){var e;let i=(e=this.userComponentFactory.getDefaultFloatingFilterType(n,()=>this.filterManager.getDefaultFloatingFilter(this.params.column)))!=null?e:"agReadOnlyFloatingFilter";return this.userComponentFactory.getFloatingFilterCompDetails(n,t,i)}parentMultiFilterInstance(n){this.params.parentFilterInstance(t=>{if(!(t instanceof F))throw new Error("AG Grid - MultiFloatingFilterComp expects MultiFilter as its parent");n(t)})}};f([L("userComponentFactory")],C.prototype,"userComponentFactory",2),f([L("filterManager")],C.prototype,"filterManager",2);var X="31.3.4",q={version:X,moduleName:B.MultiFilterModule,beans:[],userComponents:[{componentName:"agMultiColumnFilter",componentClass:F},{componentName:"agMultiColumnFloatingFilter",componentClass:C}],dependantModules:[j]};export{F as MultiFilter,q as MultiFilterModule};
