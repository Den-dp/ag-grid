var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropNames=Object.getOwnPropertyNames,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(n,e,t)=>e in n?__defProp(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,__spreadValues=(n,e)=>{for(var t in e||(e={}))__hasOwnProp.call(e,t)&&__defNormalProp(n,t,e[t]);if(__getOwnPropSymbols)for(var t of __getOwnPropSymbols(e))__propIsEnum.call(e,t)&&__defNormalProp(n,t,e[t]);return n},__spreadProps=(n,e)=>__defProps(n,__getOwnPropDescs(e)),__export=(n,e)=>{for(var t in e)__defProp(n,t,{get:e[t],enumerable:!0})},__copyProps=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of __getOwnPropNames(e))!__hasOwnProp.call(n,s)&&s!==t&&__defProp(n,s,{get:()=>e[s],enumerable:!(i=__getOwnPropDesc(e,s))||i.enumerable});return n},__toCommonJS=n=>__copyProps(__defProp({},"__esModule",{value:!0}),n),__decorateClass=(n,e,t,i)=>{for(var s=i>1?void 0:i?__getOwnPropDesc(e,t):e,r=n.length-1,l;r>=0;r--)(l=n[r])&&(s=(i?l(e,t,s):l(s))||s);return i&&s&&__defProp(e,t,s),s},main_exports={};__export(main_exports,{MultiFilter:()=>MultiFilter,MultiFilterModule:()=>MultiFilterModule}),module.exports=__toCommonJS(main_exports);var import_core3=require("@ag-grid-community/core"),import_core4=require("@ag-grid-enterprise/core"),import_core=require("@ag-grid-community/core"),_MultiFilter=class p extends import_core.TabGuardComp{constructor(){super('<div class="ag-multi-filter ag-menu-list-compact"></div>'),this.filterDefs=[],this.filters=[],this.guiDestroyFuncs=[],this.filterGuis=[],this.activeFilterIndices=[],this.lastActivatedMenuItem=null,this.afterFiltersReadyFuncs=[]}postConstruct(){this.initialiseTabGuard({onFocusIn:e=>this.onFocusIn(e)})}static getFilterDefs(e){const{filters:t}=e;return t&&t.length>0?t:[{filter:"agTextColumnFilter"},{filter:"agSetColumnFilter"}]}init(e){this.params=e,this.filterDefs=p.getFilterDefs(e);const{column:t,filterChangedCallback:i}=e;this.column=t,this.filterChangedCallback=i;const s=[];return this.filterDefs.forEach((r,l)=>{const o=this.createFilter(r,l);o!=null&&s.push(o)}),new import_core.AgPromise(r=>{import_core.AgPromise.all(s).then(l=>{this.filters=l,this.refreshGui("columnMenu").then(()=>{r()})})}).then(()=>{this.afterFiltersReadyFuncs.forEach(r=>r()),this.afterFiltersReadyFuncs.length=0})}refreshGui(e){return e===this.lastOpenedInContainer?import_core.AgPromise.resolve():(this.removeAllChildrenExceptTabGuards(),this.destroyChildren(),import_core.AgPromise.all(this.filters.map((t,i)=>{const s=this.filterDefs[i],r=this.getFilterTitle(t,s);let l;if(s.display==="subMenu"&&e!=="toolPanel")l=this.insertFilterMenu(t,r).then(o=>o.getGui());else if(s.display==="subMenu"||s.display==="accordion"){const o=this.insertFilterGroup(t,r);l=import_core.AgPromise.resolve(o.getGui())}else l=import_core.AgPromise.resolve(t.getGui());return l})).then(t=>{t.forEach((i,s)=>{s>0&&this.appendChild(import_core._.loadTemplate('<div class="ag-filter-separator"></div>')),this.appendChild(i)}),this.filterGuis=t,this.lastOpenedInContainer=e}))}getFilterTitle(e,t){return t.title!=null?t.title:e instanceof import_core.ProvidedFilter?e.getFilterTitle():"Filter"}destroyChildren(){this.guiDestroyFuncs.forEach(e=>e()),this.guiDestroyFuncs.length=0,this.filterGuis.length=0}insertFilterMenu(e,t){const i=this.createBean(new import_core.AgMenuItemComponent);return i.init({menuItemDef:{name:t,subMenu:[],cssClasses:["ag-multi-filter-menu-item"],menuItem:import_core.AgMenuItemRenderer,menuItemParams:{cssClassPrefix:"ag-compact-menu-option",isCompact:!0}},level:0,isAnotherSubMenuOpen:()=>!1,childComponent:e,contextParams:{column:null,node:null,value:null}}).then(()=>{i.setParentComponent(this),this.guiDestroyFuncs.push(()=>this.destroyBean(i)),this.addManagedListener(i,import_core.AgMenuItemComponent.EVENT_MENU_ITEM_ACTIVATED,r=>{this.lastActivatedMenuItem&&this.lastActivatedMenuItem!==r.menuItem&&this.lastActivatedMenuItem.deactivate(),this.lastActivatedMenuItem=r.menuItem});const s=i.getGui();return i.addManagedListener(s,"keydown",r=>{const{key:l}=r;switch(l){case import_core.KeyCode.UP:case import_core.KeyCode.RIGHT:case import_core.KeyCode.DOWN:case import_core.KeyCode.LEFT:r.preventDefault(),l===import_core.KeyCode.RIGHT&&i.openSubMenu(!0);break}}),i.addManagedListener(s,"focusin",()=>i.activate()),i.addManagedListener(s,"focusout",()=>{!i.isSubMenuOpen()&&!i.isSubMenuOpening()&&i.deactivate()}),i})}insertFilterGroup(e,t){const i=this.createBean(new import_core.AgGroupComponent({title:t,cssIdentifier:"multi-filter"}));return this.guiDestroyFuncs.push(()=>this.destroyBean(i)),i.addItem(e.getGui()),i.toggleGroupExpand(!1),e.afterGuiAttached&&i.addManagedListener(i,import_core.AgGroupComponent.EVENT_EXPANDED,()=>e.afterGuiAttached({container:this.lastOpenedInContainer,suppressFocus:!0,hidePopup:this.hidePopup})),i}isFilterActive(){return this.filters.some(e=>e.isFilterActive())}getLastActiveFilterIndex(){return this.activeFilterIndices.length>0?this.activeFilterIndices[this.activeFilterIndices.length-1]:null}doesFilterPass(e,t){let i=!0;return this.filters.forEach(s=>{!i||s===t||!s.isFilterActive()||(i=s.doesFilterPass(e))}),i}getFilterType(){return"multi"}getModelFromUi(){return{filterType:this.getFilterType(),filterModels:this.filters.map(t=>{const i=t;return typeof i.getModelFromUi=="function"?i.getModelFromUi():null})}}getModel(){return this.isFilterActive()?{filterType:this.getFilterType(),filterModels:this.filters.map(t=>t.isFilterActive()?t.getModel():null)}:null}setModel(e){const t=(s,r)=>new import_core.AgPromise(l=>{const o=s.setModel(r);o?o.then(()=>l()):l()});let i=[];return e==null?i=this.filters.map((s,r)=>t(s,null).then(()=>{this.updateActiveList(r)})):this.filters.forEach((s,r)=>{const l=e.filterModels.length>r?e.filterModels[r]:null,o=t(s,l).then(()=>{this.updateActiveList(r)});i.push(o)}),import_core.AgPromise.all(i).then(()=>{})}applyModel(e="api"){let t=!1;return this.filters.forEach(i=>{i instanceof import_core.ProvidedFilter&&(t=i.applyModel(e)||t)}),t}getChildFilterInstance(e){return this.filters[e]}afterGuiAttached(e){let t;e?(this.hidePopup=e.hidePopup,t=this.refreshGui(e.container)):(this.hidePopup=void 0,t=import_core.AgPromise.resolve()),t.then(()=>{const{filterDefs:i}=this;let s=!1;i&&import_core._.forEachReverse(i,(o,u)=>{var a;const c=u===0,h=!c||o.display!=="inline",g=__spreadProps(__spreadValues({},e??{}),{suppressFocus:h}),f=(a=this.filters)==null?void 0:a[u];if(f&&(this.executeFunctionIfExistsOnFilter(f,"afterGuiAttached",g),c&&(s=!0)),c&&h){const d=this.filterGuis[u];d&&(d.focus(),s=!0)}});const r=this.gos.getDocument(),l=this.gos.getActiveDomElement();!s&&(!l||l===r.body||this.getGui().contains(l))&&this.forceFocusOutOfContainer(!0)})}afterGuiDetached(){this.executeFunctionIfExists("afterGuiDetached")}onAnyFilterChanged(){this.executeFunctionIfExists("onAnyFilterChanged")}onNewRowsLoaded(){this.executeFunctionIfExists("onNewRowsLoaded")}destroy(){this.filters.forEach(e=>this.destroyBean(e)),this.filters.length=0,this.destroyChildren(),this.hidePopup=void 0,super.destroy()}executeFunctionIfExists(e,...t){import_core._.forEachReverse(this.filters,i=>{this.executeFunctionIfExistsOnFilter(i,e,t)})}executeFunctionIfExistsOnFilter(e,t,...i){const s=e[t];typeof s=="function"&&s.apply(e,i)}createFilter(e,t){const{filterModifiedCallback:i,doesRowPassOtherFilter:s}=this.params;let r;const l=__spreadProps(__spreadValues({},this.filterManager.createFilterParams(this.column,this.column.getColDef())),{filterModifiedCallback:i,filterChangedCallback:a=>{this.executeWhenAllFiltersReady(()=>this.filterChanged(t,a))},doesRowPassOtherFilter:a=>s(a)&&this.doesFilterPass({node:a,data:a.data},r)}),o=this.userComponentFactory.getFilterDetails(e,l,"agTextColumnFilter");if(!o)return null;const u=o.newAgStackInstance();return u&&u.then(a=>r=a),u}executeWhenAllFiltersReady(e){this.filters&&this.filters.length>0?e():this.afterFiltersReadyFuncs.push(e)}updateActiveList(e){const t=this.filters[e];import_core._.removeFromArray(this.activeFilterIndices,e),t.isFilterActive()&&this.activeFilterIndices.push(e)}filterChanged(e,t){this.updateActiveList(e),this.filterChangedCallback(t);const i=this.filters[e];this.filters.forEach(s=>{s!==i&&typeof s.onAnyFilterChanged=="function"&&s.onAnyFilterChanged()})}onFocusIn(e){this.lastActivatedMenuItem!=null&&!this.lastActivatedMenuItem.getGui().contains(e.target)&&(this.lastActivatedMenuItem.deactivate(),this.lastActivatedMenuItem=null)}getModelAsString(e){var t,i,s,r;if(!this.filters||!((t=e?.filterModels)!=null&&t.length))return"";const l=(i=this.getLastActiveFilterIndex())!=null?i:0,o=this.filters[l];return(r=(s=o.getModelAsString)==null?void 0:s.call(o,e.filterModels[l]))!=null?r:""}};__decorateClass([(0,import_core.Autowired)("filterManager")],_MultiFilter.prototype,"filterManager",2),__decorateClass([(0,import_core.Autowired)("userComponentFactory")],_MultiFilter.prototype,"userComponentFactory",2),__decorateClass([import_core.PostConstruct],_MultiFilter.prototype,"postConstruct",1);var MultiFilter=_MultiFilter,import_core2=require("@ag-grid-community/core"),MultiFloatingFilterComp=class extends import_core2.Component{constructor(){super('<div class="ag-multi-floating-filter ag-floating-filter-input"></div>'),this.floatingFilters=[],this.compDetailsList=[]}init(n){this.params=n;const{compDetailsList:e}=this.getCompDetailsList(n);return this.setParams(e)}setParams(n){const e=[];return n.forEach(t=>{const i=t?.newAgStackInstance();i!=null&&(this.compDetailsList.push(t),e.push(i))}),import_core2.AgPromise.all(e).then(t=>{t.forEach((i,s)=>{this.floatingFilters.push(i);const r=i.getGui();this.appendChild(r),s>0&&import_core2._.setDisplayed(r,!1)})})}onParamsUpdated(n){this.refresh(n)}refresh(n){this.params=n;const{compDetailsList:e,floatingFilterParamsList:t}=this.getCompDetailsList(n);e.length===this.compDetailsList.length&&e.every((s,r)=>!this.filterManager.areFilterCompsDifferent(this.compDetailsList[r],s))?t.forEach((s,r)=>{var l;const o=this.floatingFilters[r];let u=!1;o.refresh&&o.refresh(s)!==null&&(u=!0),u||(l=o.onParamsUpdated)==null||l.call(o,s)}):(import_core2._.clearElement(this.getGui()),this.destroyBeans(this.floatingFilters),this.floatingFilters=[],this.compDetailsList=[],this.setParams(e))}getCompDetailsList(n){const e=[],t=[],i=n.filterParams;return MultiFilter.getFilterDefs(i).forEach((s,r)=>{const l=__spreadProps(__spreadValues({},n),{parentFilterInstance:u=>{this.parentMultiFilterInstance(a=>{const c=a.getChildFilterInstance(r);c!=null&&u(c)})}});import_core2._.mergeDeep(l.filterParams,s.filterParams);const o=this.getCompDetails(s,l);o&&(e.push(o),t.push(l))}),{compDetailsList:e,floatingFilterParamsList:t}}onParentModelChanged(n,e){e&&e.afterFloatingFilter||this.parentMultiFilterInstance(t=>{if(n==null)this.floatingFilters.forEach((i,s)=>{i.onParentModelChanged(null,e),import_core2._.setDisplayed(i.getGui(),s===0)});else{const i=t.getLastActiveFilterIndex();this.floatingFilters.forEach((s,r)=>{const l=n.filterModels.length>r?n.filterModels[r]:null;s.onParentModelChanged(l,e);const o=i==null?r===0:r===i;import_core2._.setDisplayed(s.getGui(),o)})}})}destroy(){this.destroyBeans(this.floatingFilters),this.floatingFilters.length=0,super.destroy()}getCompDetails(n,e){var t;let i=(t=this.userComponentFactory.getDefaultFloatingFilterType(n,()=>this.filterManager.getDefaultFloatingFilter(this.params.column)))!=null?t:"agReadOnlyFloatingFilter";return this.userComponentFactory.getFloatingFilterCompDetails(n,e,i)}parentMultiFilterInstance(n){this.params.parentFilterInstance(e=>{if(!(e instanceof MultiFilter))throw new Error("AG Grid - MultiFloatingFilterComp expects MultiFilter as its parent");n(e)})}};__decorateClass([(0,import_core2.Autowired)("userComponentFactory")],MultiFloatingFilterComp.prototype,"userComponentFactory",2),__decorateClass([(0,import_core2.Autowired)("filterManager")],MultiFloatingFilterComp.prototype,"filterManager",2);var VERSION="31.3.4",MultiFilterModule={version:VERSION,moduleName:import_core3.ModuleNames.MultiFilterModule,beans:[],userComponents:[{componentName:"agMultiColumnFilter",componentClass:MultiFilter},{componentName:"agMultiColumnFloatingFilter",componentClass:MultiFloatingFilterComp}],dependantModules:[import_core4.EnterpriseCoreModule]};
